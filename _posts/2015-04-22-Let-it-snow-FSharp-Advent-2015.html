---
meta: A basic particle system in FSharp and WPF for FSharp Advent 2015
catagories: ["guides","examples"]
tags: ["fsharp","WPF",]
comments: true
date: 19/12/2015
title: Let It Snow! - F# Advent 2015
layout: post
---
<h1>A basic particle system in F# and WPF</h1>

<blockquote>
  <p>This post is part of the fantastic <a href="https://sergeytihon.wordpress.com/2015/10/25/f-advent-calendar-in-english-2015/">F# advent</a> event. Thanks to Sergey for organising it!</p>
</blockquote>

<p>While my post my not be quite as advanced as the others so far, I hope you'll find it as interesting as I did writing it.</p>

<p>For the post, I wanted to do something a bit different and with a <em>slightly</em> more Christmassy (more wintery at least) theme then my usual posts.</p>

<p>What could be better than a snow simulation implemented using a basic particle system?<br />
Well, probably quite a lot, but hey, it does look pretty cool - Especially with the F# logo in the background.</p>

<p>The engine is implemented entirely in F#, in a <em>mostly</em> functional manner, while the UI uses WPF.<br />
WPF might not be a great choice for particle animation, but it is familiar to me and means I can utilise [FSXaml] and [Fsharp.ViewModule] to speed up development.</p>

<p>Here's a sneak peak of where we're heading.</p>

<video autoplay controls loop poster="/content/images/post-images/FsAdvent1.jpg" src="/content/images/post-images/fsAdvent1.webm">
Sorry, your browser doesn't support HTML5 video!
Don't worry you can download the video <a href="http://stevenpemberton.net/content/images/post-images/fsAdvent1.webm">here</a> and view it in a video player.
Alternatively, you view <a href="http://stevenpemberton.net/content/images/post-images/fsAdvent1.gif">this .gif</a> instead.
</video>

<!-- more -->

<h2>Particles, particles everywhere!</h2>

<p>We'll start with a bit of background on particle engines.</p>

<p>A basic particle engine is made up of a few simple parts.</p>

<ul>
<li>Emitters: These create particles and initialise them with starting state</li>
<li>Colliders: Used to apply logic when a particle collides with an entity (or space)</li>
<li>Forces: Applied to the particles in order to alter their state</li>
</ul>

<p>These parts, are then utilised by a core <em>engine</em> in order to generate, update and effectively <em>simulate</em> a representation of a particle, or more importantly, many particles.</p>

<p>In addition, an engine requires a loop in order to drive the updating of the particle engines simulation and subsequently the rendering of the particles to the UI.
This <em>should</em> be fully abstracted away so that the UI implementation could be provided in any language/technology, as long as the engine can be called from it.</p>

<p>So, we know what is needed, where do we start?</p>

<h3>Core Types</h3>

<p>We will start by creating the necessary types that we will need in all areas of the engine code and in particular the represent our particles.
I have chosen to use records here for simplicity. It is worth pointing out that using immutable data structures, while perfectly valid, 
will slow down the implementation due to the overhead of recreating the records and containing lists each iteration.</p>

<p>However, I will stick with immutable structures (At least for the engine), as it's safer and the overhead is bearable for such a simple simulation.</p>

<p><strong>Vectors</strong></p>

<p>A particle will consist of its current coordinates, acceleration, and velocity along with various attributes that will directly affect how it is controlled by the engine and rendered to the UI. 
These main attributes can each be represented by a 2D vector (A pair of Cartesian coordinates).</p>

<p>The other attributes such as scale, rotation, alpha etc will be looked at in detail later when we declare the Particle type.</p>

<p>Firstly we will create a core types module to hold the record types and functions related to Vectors and coordinates.</p>

<p>This module includes our Vector record, which is used as both a vector and in cases where we just need Cartesian coordinates, 
in addition to some useful common functions to operate on vector records, such as for calculating the magnitude (or distance) and summing two vectors.</p>

<p>This, of course could have been implemented in a class but I like the functional approach as it will allow me to pipe the vectors to successive function calls.</p>

<p>As well as the Cartesian based vector, we also need a Polar coordinate record (an angle and radius).<br />
Polar coordinates can be used to determine a random starting direction and magnitude for our particles vectors.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">AutoOpenAttribute</span>&gt;]
<span class="k">module</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Core</span> <span class="o">=</span>

    <span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">System</span>

    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">Vector</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">X</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">float</span>; <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="i">Y</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="i">float</span> }
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="i">Polar</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs9', 10)" onmouseover="showTip(event, 'fs9', 10)" class="i">Radius</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 11)" onmouseover="showTip(event, 'fs6', 11)" class="i">float</span>; <span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="i">Theta</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 13)" onmouseover="showTip(event, 'fs6', 13)" class="i">float</span> }

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="i">defaultVector</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs5', 15)" onmouseover="showTip(event, 'fs5', 15)" class="i">X</span> <span class="o">=</span> <span class="n">0.0</span>; <span onmouseout="hideTip(event, 'fs7', 16)" onmouseover="showTip(event, 'fs7', 16)" class="i">Y</span> <span class="o">=</span> <span class="n">0.0</span> }

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 17)" onmouseover="showTip(event, 'fs12', 17)" class="i">sum</span> <span onmouseout="hideTip(event, 'fs13', 18)" onmouseover="showTip(event, 'fs13', 18)" class="i">a</span> <span onmouseout="hideTip(event, 'fs14', 19)" onmouseover="showTip(event, 'fs14', 19)" class="i">b</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs5', 20)" onmouseover="showTip(event, 'fs5', 20)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 21)" onmouseover="showTip(event, 'fs13', 21)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 22)" onmouseover="showTip(event, 'fs5', 22)" class="i">X</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs14', 23)" onmouseover="showTip(event, 'fs14', 23)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 24)" onmouseover="showTip(event, 'fs5', 24)" class="i">X</span>; <span onmouseout="hideTip(event, 'fs7', 25)" onmouseover="showTip(event, 'fs7', 25)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 26)" onmouseover="showTip(event, 'fs13', 26)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 27)" onmouseover="showTip(event, 'fs7', 27)" class="i">Y</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs14', 28)" onmouseover="showTip(event, 'fs14', 28)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 29)" onmouseover="showTip(event, 'fs7', 29)" class="i">Y</span> }
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 30)" onmouseover="showTip(event, 'fs15', 30)" class="i">diff</span> <span onmouseout="hideTip(event, 'fs13', 31)" onmouseover="showTip(event, 'fs13', 31)" class="i">a</span> <span onmouseout="hideTip(event, 'fs14', 32)" onmouseover="showTip(event, 'fs14', 32)" class="i">b</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs5', 33)" onmouseover="showTip(event, 'fs5', 33)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 34)" onmouseover="showTip(event, 'fs13', 34)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 35)" onmouseover="showTip(event, 'fs5', 35)" class="i">X</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs14', 36)" onmouseover="showTip(event, 'fs14', 36)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 37)" onmouseover="showTip(event, 'fs5', 37)" class="i">X</span>; <span onmouseout="hideTip(event, 'fs7', 38)" onmouseover="showTip(event, 'fs7', 38)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 39)" onmouseover="showTip(event, 'fs13', 39)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 40)" onmouseover="showTip(event, 'fs7', 40)" class="i">Y</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs14', 41)" onmouseover="showTip(event, 'fs14', 41)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 42)" onmouseover="showTip(event, 'fs7', 42)" class="i">Y</span> }

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 43)" onmouseover="showTip(event, 'fs16', 43)" class="i">magnitude</span> <span onmouseout="hideTip(event, 'fs17', 44)" onmouseover="showTip(event, 'fs17', 44)" class="i">vector</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 45)" onmouseover="showTip(event, 'fs18', 45)" class="i">sqrt</span> <span onmouseout="hideTip(event, 'fs17', 46)" onmouseover="showTip(event, 'fs17', 46)" class="i">vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 47)" onmouseover="showTip(event, 'fs5', 47)" class="i">X</span> <span class="o">**</span> <span class="n">2.0</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs17', 48)" onmouseover="showTip(event, 'fs17', 48)" class="i">vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 49)" onmouseover="showTip(event, 'fs7', 49)" class="i">Y</span> <span class="o">**</span> <span class="n">2.0</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 50)" onmouseover="showTip(event, 'fs19', 50)" class="i">toPolar</span> <span onmouseout="hideTip(event, 'fs20', 51)" onmouseover="showTip(event, 'fs20', 51)" class="i">vec</span> <span class="o">=</span> 
        { <span class="i">Radius</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 52)" onmouseover="showTip(event, 'fs16', 52)" class="i">magnitude</span> <span onmouseout="hideTip(event, 'fs20', 53)" onmouseover="showTip(event, 'fs20', 53)" class="i">vec</span>
          <span class="i">Theta</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 54)" onmouseover="showTip(event, 'fs3', 54)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 55)" onmouseover="showTip(event, 'fs21', 55)" class="i">Math</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 56)" onmouseover="showTip(event, 'fs22', 56)" class="i">Atan</span>(<span onmouseout="hideTip(event, 'fs20', 57)" onmouseover="showTip(event, 'fs20', 57)" class="i">vec</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 58)" onmouseover="showTip(event, 'fs7', 58)" class="i">Y</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs20', 59)" onmouseover="showTip(event, 'fs20', 59)" class="i">vec</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 60)" onmouseover="showTip(event, 'fs5', 60)" class="i">X</span>) }

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 61)" onmouseover="showTip(event, 'fs23', 61)" class="i">toCartesian</span> <span onmouseout="hideTip(event, 'fs24', 62)" onmouseover="showTip(event, 'fs24', 62)" class="i">polar</span> <span class="o">=</span> 
        { <span onmouseout="hideTip(event, 'fs5', 63)" onmouseover="showTip(event, 'fs5', 63)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 64)" onmouseover="showTip(event, 'fs24', 64)" class="i">polar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 65)" onmouseover="showTip(event, 'fs9', 65)" class="i">Radius</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs21', 66)" onmouseover="showTip(event, 'fs21', 66)" class="i">Math</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 67)" onmouseover="showTip(event, 'fs25', 67)" class="i">Cos</span>(<span onmouseout="hideTip(event, 'fs24', 68)" onmouseover="showTip(event, 'fs24', 68)" class="i">polar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 69)" onmouseover="showTip(event, 'fs10', 69)" class="i">Theta</span>)
          <span onmouseout="hideTip(event, 'fs7', 70)" onmouseover="showTip(event, 'fs7', 70)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 71)" onmouseover="showTip(event, 'fs24', 71)" class="i">polar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 72)" onmouseover="showTip(event, 'fs9', 72)" class="i">Radius</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs21', 73)" onmouseover="showTip(event, 'fs21', 73)" class="i">Math</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 74)" onmouseover="showTip(event, 'fs26', 74)" class="i">Sin</span>(<span onmouseout="hideTip(event, 'fs24', 75)" onmouseover="showTip(event, 'fs24', 75)" class="i">polar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 76)" onmouseover="showTip(event, 'fs10', 76)" class="i">Theta</span>) }</pre>
</td>
</tr>
</table>

<p>Now that we have our core types, let's look at creating a record that represents a particle.</p>

<p><strong>Particles</strong></p>

<p>We know that this particle record will need some vectors for position, acceleration and velocity.
We also know that we require some properties that will be used to alter rendering by the UI.</p>

<p>These include alpha and time to live as they can be explicitly changed by the particle engine each tick.</p>

<p>The full record can be seen below.<br />
When we get around to creating a particular representation of a particle (i.e the snow) I'll explain some of the properties in more detail.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">module</span> <span class="i">Particle</span> <span class="o">=</span>
    
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs30', 82)" onmouseover="showTip(event, 'fs30', 82)" class="i">Particle</span> <span class="o">=</span> 
        { <span onmouseout="hideTip(event, 'fs31', 83)" onmouseover="showTip(event, 'fs31', 83)" class="i">Coords</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 84)" onmouseover="showTip(event, 'fs4', 84)" class="i">Vector</span>
          <span onmouseout="hideTip(event, 'fs32', 85)" onmouseover="showTip(event, 'fs32', 85)" class="i">Mass</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs33', 86)" onmouseover="showTip(event, 'fs33', 86)" class="i">float</span>
          <span onmouseout="hideTip(event, 'fs34', 87)" onmouseover="showTip(event, 'fs34', 87)" class="i">Img</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 88)" onmouseover="showTip(event, 'fs35', 88)" class="i">string</span>
          <span onmouseout="hideTip(event, 'fs36', 89)" onmouseover="showTip(event, 'fs36', 89)" class="i">Alpha</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs33', 90)" onmouseover="showTip(event, 'fs33', 90)" class="i">float</span>
          <span onmouseout="hideTip(event, 'fs37', 91)" onmouseover="showTip(event, 'fs37', 91)" class="i">AlphaTarget</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs33', 92)" onmouseover="showTip(event, 'fs33', 92)" class="i">float</span>
          <span onmouseout="hideTip(event, 'fs38', 93)" onmouseover="showTip(event, 'fs38', 93)" class="i">Velocity</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 94)" onmouseover="showTip(event, 'fs4', 94)" class="i">Vector</span>
          <span onmouseout="hideTip(event, 'fs39', 95)" onmouseover="showTip(event, 'fs39', 95)" class="i">AngularVelocity</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs33', 96)" onmouseover="showTip(event, 'fs33', 96)" class="i">float</span>
          <span onmouseout="hideTip(event, 'fs40', 97)" onmouseover="showTip(event, 'fs40', 97)" class="i">Acceleration</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 98)" onmouseover="showTip(event, 'fs4', 98)" class="i">Vector</span>
          <span onmouseout="hideTip(event, 'fs41', 99)" onmouseover="showTip(event, 'fs41', 99)" class="i">TimeToLive</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs33', 100)" onmouseover="showTip(event, 'fs33', 100)" class="i">float</span> 
          <span onmouseout="hideTip(event, 'fs42', 101)" onmouseover="showTip(event, 'fs42', 101)" class="i">Life</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs33', 102)" onmouseover="showTip(event, 'fs33', 102)" class="i">float</span>
          <span onmouseout="hideTip(event, 'fs43', 103)" onmouseover="showTip(event, 'fs43', 103)" class="i">Rotation</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs33', 104)" onmouseover="showTip(event, 'fs33', 104)" class="i">float</span>
          <span onmouseout="hideTip(event, 'fs44', 105)" onmouseover="showTip(event, 'fs44', 105)" class="i">Scale</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs33', 106)" onmouseover="showTip(event, 'fs33', 106)" class="i">float</span>
          <span onmouseout="hideTip(event, 'fs45', 107)" onmouseover="showTip(event, 'fs45', 107)" class="i">Locked</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs46', 108)" onmouseover="showTip(event, 'fs46', 108)" class="i">bool</span>}</pre>
</td>
</tr>
</table>

<p>Let's leave the particles there for a minute and investigate what we need the engine to do with them.</p>

<h2>The Engine</h2>

<p>From the list provided earlier we can see we need a few basic things for our engine.
We will look at each of these in the coming sections, but first, a quick word on state.</p>

<h3>Engine State</h3>

<p>It's obvious that our engine will need to hold state.<br />
This state will need to be updated on a per tick basis. (I'll get into that in more detail later)</p>

<p>For now, all we care about is representing the state that must mutate each iteration. Luckily for us, there's not much we need to store.<br />
Therefore we can capture the mutable state in a single record on a new type that represents an instance of our engine, or, an animation.</p>

<p>Hopefully this will help to keep the amount of mutable state we need to track down to a minimum.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs61', 146)" onmouseover="showTip(event, 'fs61', 146)" class="i">State</span> <span class="o">=</span> 
        { <span onmouseout="hideTip(event, 'fs62', 147)" onmouseover="showTip(event, 'fs62', 147)" class="i">Particles</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs63', 148)" onmouseover="showTip(event, 'fs63', 148)" class="i">list</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs64', 149)" onmouseover="showTip(event, 'fs64', 149)" class="i">Particle</span><span class="o">&gt;</span>
          <span onmouseout="hideTip(event, 'fs65', 150)" onmouseover="showTip(event, 'fs65', 150)" class="i">Forces</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs63', 151)" onmouseover="showTip(event, 'fs63', 151)" class="i">list</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs4', 152)" onmouseover="showTip(event, 'fs4', 152)" class="i">Vector</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 153)" onmouseover="showTip(event, 'fs4', 153)" class="i">Vector</span><span class="o">&gt;</span>
          <span onmouseout="hideTip(event, 'fs66', 154)" onmouseover="showTip(event, 'fs66', 154)" class="i">Colliders</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs63', 155)" onmouseover="showTip(event, 'fs63', 155)" class="i">list</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs64', 156)" onmouseover="showTip(event, 'fs64', 156)" class="i">Particle</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs64', 157)" onmouseover="showTip(event, 'fs64', 157)" class="i">Particle</span><span class="o">&gt;</span> 
          <span onmouseout="hideTip(event, 'fs67', 158)" onmouseover="showTip(event, 'fs67', 158)" class="i">Elapsed</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 159)" onmouseover="showTip(event, 'fs6', 159)" class="i">float</span>}

    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs68', 160)" onmouseover="showTip(event, 'fs68', 160)" class="i">Animation</span>(<span onmouseout="hideTip(event, 'fs69', 161)" onmouseover="showTip(event, 'fs69', 161)" class="i">spawnRate</span>, <span onmouseout="hideTip(event, 'fs70', 162)" onmouseover="showTip(event, 'fs70', 162)" class="i">maxParticles</span>, <span onmouseout="hideTip(event, 'fs71', 163)" onmouseover="showTip(event, 'fs71', 163)" class="i">particleEmitter</span>, <span onmouseout="hideTip(event, 'fs72', 164)" onmouseover="showTip(event, 'fs72', 164)" class="i">tick</span>, <span onmouseout="hideTip(event, 'fs73', 165)" onmouseover="showTip(event, 'fs73', 165)" class="i">forces</span>, <span onmouseout="hideTip(event, 'fs74', 166)" onmouseover="showTip(event, 'fs74', 166)" class="i">colliders</span>) <span class="k">as</span> <span onmouseout="hideTip(event, 'fs75', 167)" onmouseover="showTip(event, 'fs75', 167)" class="i">x</span> <span class="o">=</span> </pre>
</td>
</tr>
</table>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs78', 171)" onmouseover="showTip(event, 'fs78', 171)" class="i">state</span> <span class="o">=</span> 
            { <span class="i">Particles</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs63', 172)" onmouseover="showTip(event, 'fs63', 172)" class="i">list</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs64', 173)" onmouseover="showTip(event, 'fs64', 173)" class="i">Particle</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Empty</span>
              <span class="i">Forces</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs73', 174)" onmouseover="showTip(event, 'fs73', 174)" class="i">forces</span>
              <span class="i">Colliders</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs74', 175)" onmouseover="showTip(event, 'fs74', 175)" class="i">colliders</span>
              <span class="i">Elapsed</span> <span class="o">=</span> <span class="n">0.0</span> }
    </pre>
</td>
</tr>
</table>

<p>The state record will be used to hold the animations list of particles, the forces in play, the colliders to use, and a counter for elapsed time.
You can also see that I have specified a few more parameters in addition to these on the animation types constructor.</p>

<p>These are:</p>

<ul>
<li>A Particle emitter. We mentioned emitters earlier and will see them again later. They basically create particles for the animation.</li>
<li>Spawn rate. The rate at which particles are spawned (in particles per second)</li>
<li>Max Particles. The upper limit of particles that can exist at one time.</li>
<li>Tick. This is a function that can be used to apply additional, custom logic on an animation tick.</li>
</ul>

<p>With this in place, we can go about defining a function that will update the animation on each iteration of a loop.</p>

<p>The loop itself is not defined in the engine, but rather in the calling code. 
This allows for specific architectures to best perform the looping to the renderers benefit.</p>

<p>The update function will need to do multiple things.</p>

<ul>
<li>Call any specific update function of the animation</li>
<li>Spawn new particles using the provided emitter</li>
<li>Calculate each particles acceleration vector, applying any required forces</li>
<li>Check each particle for collisions</li>
<li>Update the particles position based on previous steps</li>
</ul>

<p>We can therefore work through this list to handle each step.</p>

<h3>Emitters - Spawning new particles</h3>

<p>New particles are spawned by using the emitter passed to the animations constructor.
An emitter is a simple function that creates a particle and sets some default values.</p>

<p>This emitter is utilised in a spawning function which takes an amount of particles to spawn and the current particle list as parameters.<br />
It can then recursively spawn particles until this amount is reached, at which point it will return then new list.</p>

<p>Note, everything is immutable here, so we are creating new particles and a list each iteration which is obviously not the most efficient thing to do.<br />
There will also come a time when we hit the limit on the number of particles we can create (taken from the max particles parameter passed to the constructor).<br />
At which time, we need to replace an old dead particle, with a new one.</p>

<p>By keeping all the dead particles in the array, we can easily replace a dead particle from within our spawning function.<br />
We then gain the benefit of not having to keep track of particles via an id, or by holding multiple collections.<br />
Instead we can rely on the fact that once a particle is created, it stays in the same index of the list.</p>

<p>This, as we will see later, helps with keeping things simple when it comes to rendering.</p>

<p>Below is the <code>spawnParticle</code> and <code>replace</code> functions.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs79', 176)" onmouseover="showTip(event, 'fs79', 176)" class="i">replace</span> <span onmouseout="hideTip(event, 'fs80', 177)" onmouseover="showTip(event, 'fs80', 177)" class="i">test</span> <span onmouseout="hideTip(event, 'fs81', 178)" onmouseover="showTip(event, 'fs81', 178)" class="i">replacement</span> <span onmouseout="hideTip(event, 'fs82', 179)" onmouseover="showTip(event, 'fs82', 179)" class="i">list</span> <span class="o">=</span> 
            <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs83', 180)" onmouseover="showTip(event, 'fs83', 180)" class="i">search</span> <span onmouseout="hideTip(event, 'fs84', 181)" onmouseover="showTip(event, 'fs84', 181)" class="i">acc</span> <span class="o">=</span> 
                <span class="k">function</span> 
                | [] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs85', 182)" onmouseover="showTip(event, 'fs85', 182)" class="i">None</span>
                | <span onmouseout="hideTip(event, 'fs86', 183)" onmouseover="showTip(event, 'fs86', 183)" class="i">h</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs87', 184)" onmouseover="showTip(event, 'fs87', 184)" class="i">t</span> <span class="k">-&gt;</span> 
                    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs80', 185)" onmouseover="showTip(event, 'fs80', 185)" class="i">test</span> <span onmouseout="hideTip(event, 'fs86', 186)" onmouseover="showTip(event, 'fs86', 186)" class="i">h</span> <span class="k">with</span>
                    | <span class="k">true</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs88', 187)" onmouseover="showTip(event, 'fs88', 187)" class="i">Some</span>(<span onmouseout="hideTip(event, 'fs89', 188)" onmouseover="showTip(event, 'fs89', 188)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 189)" onmouseover="showTip(event, 'fs90', 189)" class="i">rev</span> <span onmouseout="hideTip(event, 'fs87', 190)" onmouseover="showTip(event, 'fs87', 190)" class="i">t</span> <span class="o">@</span> <span onmouseout="hideTip(event, 'fs81', 191)" onmouseover="showTip(event, 'fs81', 191)" class="i">replacement</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs84', 192)" onmouseover="showTip(event, 'fs84', 192)" class="i">acc</span>)
                    | <span class="k">false</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs83', 193)" onmouseover="showTip(event, 'fs83', 193)" class="i">search</span> (<span onmouseout="hideTip(event, 'fs86', 194)" onmouseover="showTip(event, 'fs86', 194)" class="i">h</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs84', 195)" onmouseover="showTip(event, 'fs84', 195)" class="i">acc</span>) <span onmouseout="hideTip(event, 'fs87', 196)" onmouseover="showTip(event, 'fs87', 196)" class="i">t</span>
            <span onmouseout="hideTip(event, 'fs83', 197)" onmouseover="showTip(event, 'fs83', 197)" class="i">search</span> [] <span onmouseout="hideTip(event, 'fs82', 198)" onmouseover="showTip(event, 'fs82', 198)" class="i">list</span>
    
        <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs91', 199)" onmouseover="showTip(event, 'fs91', 199)" class="i">spawnParticles</span> <span onmouseout="hideTip(event, 'fs92', 200)" onmouseover="showTip(event, 'fs92', 200)" class="i">toSpawn</span> (<span onmouseout="hideTip(event, 'fs93', 201)" onmouseover="showTip(event, 'fs93', 201)" class="i">accu</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs64', 202)" onmouseover="showTip(event, 'fs64', 202)" class="i">Particle</span> <span onmouseout="hideTip(event, 'fs63', 203)" onmouseover="showTip(event, 'fs63', 203)" class="i">list</span>) <span class="o">=</span> 
            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs92', 204)" onmouseover="showTip(event, 'fs92', 204)" class="i">toSpawn</span> <span class="k">with</span>
            | <span onmouseout="hideTip(event, 'fs94', 205)" onmouseover="showTip(event, 'fs94', 205)" class="i">a</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs93', 206)" onmouseover="showTip(event, 'fs93', 206)" class="i">accu</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs95', 207)" onmouseover="showTip(event, 'fs95', 207)" class="i">Length</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs70', 208)" onmouseover="showTip(event, 'fs70', 208)" class="i">maxParticles</span> <span class="k">-&gt;</span> 
                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs96', 209)" onmouseover="showTip(event, 'fs96', 209)" class="i">replaced</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs79', 210)" onmouseover="showTip(event, 'fs79', 210)" class="i">replace</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs97', 211)" onmouseover="showTip(event, 'fs97', 211)" class="i">p</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs97', 212)" onmouseover="showTip(event, 'fs97', 212)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 213)" onmouseover="showTip(event, 'fs45', 213)" class="i">Locked</span> <span class="o">||</span> <span onmouseout="hideTip(event, 'fs97', 214)" onmouseover="showTip(event, 'fs97', 214)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 215)" onmouseover="showTip(event, 'fs41', 215)" class="i">TimeToLive</span> <span class="o">&lt;</span> <span class="n">0.0</span>) (<span onmouseout="hideTip(event, 'fs71', 216)" onmouseover="showTip(event, 'fs71', 216)" class="i">particleEmitter</span>()) <span onmouseout="hideTip(event, 'fs93', 217)" onmouseover="showTip(event, 'fs93', 217)" class="i">accu</span>
                <span class="k">match</span> <span onmouseout="hideTip(event, 'fs96', 218)" onmouseover="showTip(event, 'fs96', 218)" class="i">replaced</span> <span class="k">with</span>
                | <span onmouseout="hideTip(event, 'fs88', 219)" onmouseover="showTip(event, 'fs88', 219)" class="i">Some</span> <span onmouseout="hideTip(event, 'fs98', 220)" onmouseover="showTip(event, 'fs98', 220)" class="i">replaced</span> <span class="k">-&gt;</span> 
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs92', 221)" onmouseover="showTip(event, 'fs92', 221)" class="i">toSpawn</span> <span class="o">&gt;</span> <span class="n">1.0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs91', 222)" onmouseover="showTip(event, 'fs91', 222)" class="i">spawnParticles</span> (<span onmouseout="hideTip(event, 'fs92', 223)" onmouseover="showTip(event, 'fs92', 223)" class="i">toSpawn</span> <span class="o">-</span> <span class="n">1.0</span>) <span onmouseout="hideTip(event, 'fs98', 224)" onmouseover="showTip(event, 'fs98', 224)" class="i">replaced</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 225)" onmouseover="showTip(event, 'fs89', 225)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 226)" onmouseover="showTip(event, 'fs90', 226)" class="i">rev</span>
                    <span class="k">else</span> <span onmouseout="hideTip(event, 'fs98', 227)" onmouseover="showTip(event, 'fs98', 227)" class="i">replaced</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 228)" onmouseover="showTip(event, 'fs89', 228)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 229)" onmouseover="showTip(event, 'fs90', 229)" class="i">rev</span>
                | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs93', 230)" onmouseover="showTip(event, 'fs93', 230)" class="i">accu</span>
            | <span onmouseout="hideTip(event, 'fs99', 231)" onmouseover="showTip(event, 'fs99', 231)" class="i">b</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs92', 232)" onmouseover="showTip(event, 'fs92', 232)" class="i">toSpawn</span> <span class="o">&gt;</span> <span class="n">0.0</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs71', 233)" onmouseover="showTip(event, 'fs71', 233)" class="i">particleEmitter</span>() <span class="o">::</span> <span onmouseout="hideTip(event, 'fs93', 234)" onmouseover="showTip(event, 'fs93', 234)" class="i">accu</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs91', 235)" onmouseover="showTip(event, 'fs91', 235)" class="i">spawnParticles</span> (<span onmouseout="hideTip(event, 'fs92', 236)" onmouseover="showTip(event, 'fs92', 236)" class="i">toSpawn</span> <span class="o">-</span> <span class="n">1.0</span>)
            | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs93', 237)" onmouseover="showTip(event, 'fs93', 237)" class="i">accu</span></pre>
</td>
</tr>
</table>

<h3>Forces - Calculating Particle Acceleration</h3>

<p>Next up, determining the new value for a particles acceleration.<br />
Acceleration can be determined by following Newton's 2nd law of motion.</p>

<blockquote>
  <p>Acceleration = Force / Mass</p>
</blockquote>

<p>Force in this case is net force, which is the sum of all forces in our animation.</p>

<p>Calculating net force is a fairly trivial task, we just need to apply each force to a particles current vector (coordinates), 
summing them as we go. A fold is the perfect choice here as it won't fail if the list is empty, we simply get back the initial state.</p>

<p>We then divide this by the particles mass.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs100', 238)" onmouseover="showTip(event, 'fs100', 238)" class="i">applyForce</span> <span onmouseout="hideTip(event, 'fs101', 239)" onmouseover="showTip(event, 'fs101', 239)" class="i">particle</span> <span onmouseout="hideTip(event, 'fs102', 240)" onmouseover="showTip(event, 'fs102', 240)" class="i">accel</span> <span onmouseout="hideTip(event, 'fs103', 241)" onmouseover="showTip(event, 'fs103', 241)" class="i">force</span> <span class="o">=</span>
            <span onmouseout="hideTip(event, 'fs101', 242)" onmouseover="showTip(event, 'fs101', 242)" class="i">particle</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 243)" onmouseover="showTip(event, 'fs31', 243)" class="i">Coords</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs103', 244)" onmouseover="showTip(event, 'fs103', 244)" class="i">force</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 245)" onmouseover="showTip(event, 'fs12', 245)" class="i">sum</span> <span onmouseout="hideTip(event, 'fs102', 246)" onmouseover="showTip(event, 'fs102', 246)" class="i">accel</span>

        <span class="c">//A = F/M</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs104', 247)" onmouseover="showTip(event, 'fs104', 247)" class="i">calcAcceleration</span> <span onmouseout="hideTip(event, 'fs101', 248)" onmouseover="showTip(event, 'fs101', 248)" class="i">particle</span> <span class="o">=</span> 
            { <span onmouseout="hideTip(event, 'fs101', 249)" onmouseover="showTip(event, 'fs101', 249)" class="i">particle</span> <span class="k">with</span> <span class="i">Acceleration</span> <span class="o">=</span> 
                                <span onmouseout="hideTip(event, 'fs78', 250)" onmouseover="showTip(event, 'fs78', 250)" class="i">state</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs65', 251)" onmouseover="showTip(event, 'fs65', 251)" class="i">Forces</span>
                                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 252)" onmouseover="showTip(event, 'fs89', 252)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs105', 253)" onmouseover="showTip(event, 'fs105', 253)" class="i">fold</span> (<span onmouseout="hideTip(event, 'fs100', 254)" onmouseover="showTip(event, 'fs100', 254)" class="i">applyForce</span> <span onmouseout="hideTip(event, 'fs101', 255)" onmouseover="showTip(event, 'fs101', 255)" class="i">particle</span>) <span onmouseout="hideTip(event, 'fs11', 256)" onmouseover="showTip(event, 'fs11', 256)" class="i">defaultVector</span>
                                <span class="o">|&gt;</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs106', 257)" onmouseover="showTip(event, 'fs106', 257)" class="i">f</span> <span class="k">-&gt;</span> { <span onmouseout="hideTip(event, 'fs106', 258)" onmouseover="showTip(event, 'fs106', 258)" class="i">f</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs5', 259)" onmouseover="showTip(event, 'fs5', 259)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs106', 260)" onmouseover="showTip(event, 'fs106', 260)" class="i">f</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 261)" onmouseover="showTip(event, 'fs5', 261)" class="i">X</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs101', 262)" onmouseover="showTip(event, 'fs101', 262)" class="i">particle</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs32', 263)" onmouseover="showTip(event, 'fs32', 263)" class="i">Mass</span>
                                                     <span onmouseout="hideTip(event, 'fs7', 264)" onmouseover="showTip(event, 'fs7', 264)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs106', 265)" onmouseover="showTip(event, 'fs106', 265)" class="i">f</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 266)" onmouseover="showTip(event, 'fs7', 266)" class="i">Y</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs101', 267)" onmouseover="showTip(event, 'fs101', 267)" class="i">particle</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs32', 268)" onmouseover="showTip(event, 'fs32', 268)" class="i">Mass</span> }}</pre>
</td>
</tr>
</table>

<p>After calculating the acceleration, we check for collisions.</p>

<h3>Colliders - Handling Particle Collisions</h3>

<p>Collisions come in many guises ranging from simple floor/wall collisions, to more complex collisions with other particles or objects.
For our simple animation, I will only require a collider on the floor and possibly the walls.</p>

<p>A collider can be defined as a set of bounds, and in the simplest form, a box, represented by a pair of vectors.
We can also include the logic to handle what happens when a collision is detected within the collision function itself.</p>

<p>This is achieved by creating a simple helper function which we then wrap in a specific collider function that takes a particle as input.
We can then utilise this 'box collider' by augmenting it with explicit logic to execute when a collision occurs.<br />
For instance, locking a particle in place.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs107', 269)" onmouseover="showTip(event, 'fs107', 269)" class="i">pointInBounds</span> (<span onmouseout="hideTip(event, 'fs108', 270)" onmouseover="showTip(event, 'fs108', 270)" class="i">min</span>,<span onmouseout="hideTip(event, 'fs109', 271)" onmouseover="showTip(event, 'fs109', 271)" class="i">max</span>) <span onmouseout="hideTip(event, 'fs110', 272)" onmouseover="showTip(event, 'fs110', 272)" class="i">point</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs108', 273)" onmouseover="showTip(event, 'fs108', 273)" class="i">min</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 274)" onmouseover="showTip(event, 'fs5', 274)" class="i">X</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs110', 275)" onmouseover="showTip(event, 'fs110', 275)" class="i">point</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 276)" onmouseover="showTip(event, 'fs5', 276)" class="i">X</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs109', 277)" onmouseover="showTip(event, 'fs109', 277)" class="i">max</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 278)" onmouseover="showTip(event, 'fs7', 278)" class="i">Y</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs110', 279)" onmouseover="showTip(event, 'fs110', 279)" class="i">point</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 280)" onmouseover="showTip(event, 'fs7', 280)" class="i">Y</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs108', 281)" onmouseover="showTip(event, 'fs108', 281)" class="i">min</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 282)" onmouseover="showTip(event, 'fs7', 282)" class="i">Y</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs110', 283)" onmouseover="showTip(event, 'fs110', 283)" class="i">point</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 284)" onmouseover="showTip(event, 'fs7', 284)" class="i">Y</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs109', 285)" onmouseover="showTip(event, 'fs109', 285)" class="i">max</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 286)" onmouseover="showTip(event, 'fs7', 286)" class="i">Y</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs110', 287)" onmouseover="showTip(event, 'fs110', 287)" class="i">point</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 288)" onmouseover="showTip(event, 'fs7', 288)" class="i">Y</span>
    
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs111', 289)" onmouseover="showTip(event, 'fs111', 289)" class="i">boxCollider</span> <span onmouseout="hideTip(event, 'fs108', 290)" onmouseover="showTip(event, 'fs108', 290)" class="i">min</span> <span onmouseout="hideTip(event, 'fs109', 291)" onmouseover="showTip(event, 'fs109', 291)" class="i">max</span> <span onmouseout="hideTip(event, 'fs101', 292)" onmouseover="showTip(event, 'fs101', 292)" class="i">particle</span> <span class="o">=</span>
            <span onmouseout="hideTip(event, 'fs107', 293)" onmouseover="showTip(event, 'fs107', 293)" class="i">pointInBounds</span> (<span onmouseout="hideTip(event, 'fs108', 294)" onmouseover="showTip(event, 'fs108', 294)" class="i">min</span>,<span onmouseout="hideTip(event, 'fs109', 295)" onmouseover="showTip(event, 'fs109', 295)" class="i">max</span>) <span onmouseout="hideTip(event, 'fs101', 296)" onmouseover="showTip(event, 'fs101', 296)" class="i">particle</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 297)" onmouseover="showTip(event, 'fs31', 297)" class="i">Coords</span>

        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs112', 298)" onmouseover="showTip(event, 'fs112', 298)" class="i">floorCollider</span> <span onmouseout="hideTip(event, 'fs101', 299)" onmouseover="showTip(event, 'fs101', 299)" class="i">particle</span> <span class="o">=</span> 
            {<span onmouseout="hideTip(event, 'fs101', 300)" onmouseover="showTip(event, 'fs101', 300)" class="i">particle</span> <span class="k">with</span> <span class="i">Locked</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs111', 301)" onmouseover="showTip(event, 'fs111', 301)" class="i">boxCollider</span> {<span onmouseout="hideTip(event, 'fs5', 302)" onmouseover="showTip(event, 'fs5', 302)" class="i">X</span> <span class="o">=</span> <span class="n">0.0</span>; <span onmouseout="hideTip(event, 'fs7', 303)" onmouseover="showTip(event, 'fs7', 303)" class="i">Y</span><span class="o">=</span><span class="n">670.0</span>} {<span onmouseout="hideTip(event, 'fs5', 304)" onmouseover="showTip(event, 'fs5', 304)" class="i">X</span> <span class="o">=</span> <span class="n">1280.0</span>; <span onmouseout="hideTip(event, 'fs7', 305)" onmouseover="showTip(event, 'fs7', 305)" class="i">Y</span><span class="o">=</span><span class="n">720.0</span>} <span onmouseout="hideTip(event, 'fs101', 306)" onmouseover="showTip(event, 'fs101', 306)" class="i">particle</span>}</pre>
</td>
</tr>
</table>

<p>We see above the use of a box collider that will lock a particle in place when it hits an area of the screen near to the floor.</p>

<p>To use this, and any other colliders, we only need execute them in turn. Or better yet, compose them together.<br />
We can utilise fold to do this, like so.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs113', 307)" onmouseover="showTip(event, 'fs113', 307)" class="i">applyColliders</span> <span onmouseout="hideTip(event, 'fs101', 308)" onmouseover="showTip(event, 'fs101', 308)" class="i">particle</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs101', 309)" onmouseover="showTip(event, 'fs101', 309)" class="i">particle</span>
            <span class="o">|&gt;</span> <span class="k">match</span> <span onmouseout="hideTip(event, 'fs78', 310)" onmouseover="showTip(event, 'fs78', 310)" class="i">state</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs66', 311)" onmouseover="showTip(event, 'fs66', 311)" class="i">Colliders</span> <span class="k">with</span>
               | [] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs114', 312)" onmouseover="showTip(event, 'fs114', 312)" class="i">id</span>
               | <span onmouseout="hideTip(event, 'fs115', 313)" onmouseover="showTip(event, 'fs115', 313)" class="i">list</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs115', 314)" onmouseover="showTip(event, 'fs115', 314)" class="i">list</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 315)" onmouseover="showTip(event, 'fs89', 315)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs105', 316)" onmouseover="showTip(event, 'fs105', 316)" class="i">fold</span> (<span class="o">&gt;</span><span class="o">&gt;</span>) <span onmouseout="hideTip(event, 'fs114', 317)" onmouseover="showTip(event, 'fs114', 317)" class="i">id</span>)</pre>
</td>
</tr>
</table>

<p>The final piece of the puzzle is to apply the rest of the updates to the particle.<br />
This includes an alpha fade in/out as well as the current coordinates.</p>

<p>At the same time we decrement the particles life by the delta time (the amount of time passed since the last tick) and update it's coordinates and velocity, 
by summing them with velocity and acceleration respectively.</p>

<p>The delta time is also used to adjust the values here.<br />
This attempts to keep the simulation at a constant speed across a varying speed of ticks (for example, a fast vs slow computer should see the particles change by the same amount).</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs116', 318)" onmouseover="showTip(event, 'fs116', 318)" class="i">updateAlpha</span> <span onmouseout="hideTip(event, 'fs97', 319)" onmouseover="showTip(event, 'fs97', 319)" class="i">p</span> <span class="o">=</span>
            <span class="k">match</span> <span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs97', 320)" onmouseover="showTip(event, 'fs97', 320)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 321)" onmouseover="showTip(event, 'fs41', 321)" class="i">TimeToLive</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs97', 322)" onmouseover="showTip(event, 'fs97', 322)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 323)" onmouseover="showTip(event, 'fs42', 323)" class="i">Life</span> <span class="k">with</span>
            | <span onmouseout="hideTip(event, 'fs117', 324)" onmouseover="showTip(event, 'fs117', 324)" class="i">lifeRatio</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs117', 325)" onmouseover="showTip(event, 'fs117', 325)" class="i">lifeRatio</span> <span class="o">&lt;=</span> <span class="n">0.25</span>
                <span class="k">-&gt;</span> { <span onmouseout="hideTip(event, 'fs97', 326)" onmouseover="showTip(event, 'fs97', 326)" class="i">p</span> <span class="k">with</span> <span class="i">Alpha</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs117', 327)" onmouseover="showTip(event, 'fs117', 327)" class="i">lifeRatio</span> <span class="o">/</span> <span class="n">0.25</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs97', 328)" onmouseover="showTip(event, 'fs97', 328)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 329)" onmouseover="showTip(event, 'fs37', 329)" class="i">AlphaTarget</span> }
            | <span onmouseout="hideTip(event, 'fs117', 330)" onmouseover="showTip(event, 'fs117', 330)" class="i">lifeRatio</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs117', 331)" onmouseover="showTip(event, 'fs117', 331)" class="i">lifeRatio</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">0.75</span> 
                <span class="k">-&gt;</span> { <span onmouseout="hideTip(event, 'fs97', 332)" onmouseover="showTip(event, 'fs97', 332)" class="i">p</span> <span class="k">with</span> <span class="i">Alpha</span> <span class="o">=</span> (<span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs117', 333)" onmouseover="showTip(event, 'fs117', 333)" class="i">lifeRatio</span>) <span class="o">/</span> <span class="n">0.25</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs97', 334)" onmouseover="showTip(event, 'fs97', 334)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 335)" onmouseover="showTip(event, 'fs37', 335)" class="i">AlphaTarget</span> }
            | _ <span class="k">-&gt;</span> { <span onmouseout="hideTip(event, 'fs97', 336)" onmouseover="showTip(event, 'fs97', 336)" class="i">p</span> <span class="k">with</span> <span class="i">Alpha</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs97', 337)" onmouseover="showTip(event, 'fs97', 337)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 338)" onmouseover="showTip(event, 'fs37', 338)" class="i">AlphaTarget</span> }

        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs118', 339)" onmouseover="showTip(event, 'fs118', 339)" class="i">updatePosition</span> <span onmouseout="hideTip(event, 'fs119', 340)" onmouseover="showTip(event, 'fs119', 340)" class="i">delta</span> <span onmouseout="hideTip(event, 'fs97', 341)" onmouseover="showTip(event, 'fs97', 341)" class="i">p</span> <span class="o">=</span> 
            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs97', 342)" onmouseover="showTip(event, 'fs97', 342)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 343)" onmouseover="showTip(event, 'fs45', 343)" class="i">Locked</span> <span class="k">with</span>
            | <span class="k">true</span> <span class="k">-&gt;</span> { <span onmouseout="hideTip(event, 'fs97', 344)" onmouseover="showTip(event, 'fs97', 344)" class="i">p</span> <span class="k">with</span> <span class="i">TimeToLive</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs97', 345)" onmouseover="showTip(event, 'fs97', 345)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 346)" onmouseover="showTip(event, 'fs41', 346)" class="i">TimeToLive</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs119', 347)" onmouseover="showTip(event, 'fs119', 347)" class="i">delta</span> }
            | <span class="k">false</span> <span class="k">-&gt;</span> 
                { <span onmouseout="hideTip(event, 'fs97', 348)" onmouseover="showTip(event, 'fs97', 348)" class="i">p</span> <span class="k">with</span> <span class="i">TimeToLive</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs97', 349)" onmouseover="showTip(event, 'fs97', 349)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 350)" onmouseover="showTip(event, 'fs41', 350)" class="i">TimeToLive</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs119', 351)" onmouseover="showTip(event, 'fs119', 351)" class="i">delta</span>
                         <span class="i">Coords</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs5', 352)" onmouseover="showTip(event, 'fs5', 352)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs97', 353)" onmouseover="showTip(event, 'fs97', 353)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs38', 354)" onmouseover="showTip(event, 'fs38', 354)" class="i">Velocity</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 355)" onmouseover="showTip(event, 'fs5', 355)" class="i">X</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs119', 356)" onmouseover="showTip(event, 'fs119', 356)" class="i">delta</span>
                                    <span onmouseout="hideTip(event, 'fs7', 357)" onmouseover="showTip(event, 'fs7', 357)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs97', 358)" onmouseover="showTip(event, 'fs97', 358)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs38', 359)" onmouseover="showTip(event, 'fs38', 359)" class="i">Velocity</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 360)" onmouseover="showTip(event, 'fs7', 360)" class="i">Y</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs119', 361)" onmouseover="showTip(event, 'fs119', 361)" class="i">delta</span> }
                                  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 362)" onmouseover="showTip(event, 'fs12', 362)" class="i">sum</span> <span onmouseout="hideTip(event, 'fs97', 363)" onmouseover="showTip(event, 'fs97', 363)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 364)" onmouseover="showTip(event, 'fs31', 364)" class="i">Coords</span> 
                         <span class="i">Velocity</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs5', 365)" onmouseover="showTip(event, 'fs5', 365)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs97', 366)" onmouseover="showTip(event, 'fs97', 366)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 367)" onmouseover="showTip(event, 'fs40', 367)" class="i">Acceleration</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 368)" onmouseover="showTip(event, 'fs5', 368)" class="i">X</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs119', 369)" onmouseover="showTip(event, 'fs119', 369)" class="i">delta</span>
                                      <span onmouseout="hideTip(event, 'fs7', 370)" onmouseover="showTip(event, 'fs7', 370)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs97', 371)" onmouseover="showTip(event, 'fs97', 371)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 372)" onmouseover="showTip(event, 'fs40', 372)" class="i">Acceleration</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 373)" onmouseover="showTip(event, 'fs7', 373)" class="i">Y</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs119', 374)" onmouseover="showTip(event, 'fs119', 374)" class="i">delta</span> }
                                    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 375)" onmouseover="showTip(event, 'fs12', 375)" class="i">sum</span> <span onmouseout="hideTip(event, 'fs97', 376)" onmouseover="showTip(event, 'fs97', 376)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs38', 377)" onmouseover="showTip(event, 'fs38', 377)" class="i">Velocity</span> 
                         <span class="i">Rotation</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs97', 378)" onmouseover="showTip(event, 'fs97', 378)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 379)" onmouseover="showTip(event, 'fs43', 379)" class="i">Rotation</span> <span class="o">+</span> (<span onmouseout="hideTip(event, 'fs97', 380)" onmouseover="showTip(event, 'fs97', 380)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 381)" onmouseover="showTip(event, 'fs39', 381)" class="i">AngularVelocity</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs119', 382)" onmouseover="showTip(event, 'fs119', 382)" class="i">delta</span>) }</pre>
</td>
</tr>
</table>

<p>By bringing this all together we can finally define our update function.<br />
We make use of <code>List.map</code> to create a new list of particles from all the update functions, which is then set into a new state record for the animation to store.</p>

<p>A public port of this update function is created by declaring the respective member on the animation type.<br />
This is the how the we control how often the engine is updated from within the simulation loop.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 383)" onmouseover="showTip(event, 'fs72', 383)" class="i">tick</span> <span onmouseout="hideTip(event, 'fs119', 384)" onmouseover="showTip(event, 'fs119', 384)" class="i">delta</span> <span onmouseout="hideTip(event, 'fs120', 385)" onmouseover="showTip(event, 'fs120', 385)" class="i">state</span> <span class="o">=</span> 
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs121', 386)" onmouseover="showTip(event, 'fs121', 386)" class="i">updatedState</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs72', 387)" onmouseover="showTip(event, 'fs72', 387)" class="i">tick</span> <span onmouseout="hideTip(event, 'fs119', 388)" onmouseover="showTip(event, 'fs119', 388)" class="i">delta</span> <span onmouseout="hideTip(event, 'fs120', 389)" onmouseover="showTip(event, 'fs120', 389)" class="i">state</span> <span class="c">// Tick updates forces</span>
            { <span onmouseout="hideTip(event, 'fs121', 390)" onmouseover="showTip(event, 'fs121', 390)" class="i">updatedState</span> <span class="k">with</span> <span class="i">Particles</span> <span class="o">=</span> 
                                    <span onmouseout="hideTip(event, 'fs121', 391)" onmouseover="showTip(event, 'fs121', 391)" class="i">updatedState</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs62', 392)" onmouseover="showTip(event, 'fs62', 392)" class="i">Particles</span>
                                    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 393)" onmouseover="showTip(event, 'fs89', 393)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 394)" onmouseover="showTip(event, 'fs90', 394)" class="i">rev</span>
                                    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs91', 395)" onmouseover="showTip(event, 'fs91', 395)" class="i">spawnParticles</span> (<span onmouseout="hideTip(event, 'fs119', 396)" onmouseover="showTip(event, 'fs119', 396)" class="i">delta</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs69', 397)" onmouseover="showTip(event, 'fs69', 397)" class="i">spawnRate</span>)
                                    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 398)" onmouseover="showTip(event, 'fs89', 398)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs122', 399)" onmouseover="showTip(event, 'fs122', 399)" class="i">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs97', 400)" onmouseover="showTip(event, 'fs97', 400)" class="i">p</span> <span class="k">-&gt;</span> 
                                           <span onmouseout="hideTip(event, 'fs104', 401)" onmouseover="showTip(event, 'fs104', 401)" class="i">calcAcceleration</span> <span onmouseout="hideTip(event, 'fs97', 402)" onmouseover="showTip(event, 'fs97', 402)" class="i">p</span>
                                           <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs113', 403)" onmouseover="showTip(event, 'fs113', 403)" class="i">applyColliders</span>
                                           <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs116', 404)" onmouseover="showTip(event, 'fs116', 404)" class="i">updateAlpha</span>
                                           <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs118', 405)" onmouseover="showTip(event, 'fs118', 405)" class="i">updatePosition</span> <span onmouseout="hideTip(event, 'fs119', 406)" onmouseover="showTip(event, 'fs119', 406)" class="i">delta</span>) }

        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs123', 407)" onmouseover="showTip(event, 'fs123', 407)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs124', 408)" onmouseover="showTip(event, 'fs124', 408)" class="i">Update</span>(<span onmouseout="hideTip(event, 'fs119', 409)" onmouseover="showTip(event, 'fs119', 409)" class="i">delta</span>) <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs78', 410)" onmouseover="showTip(event, 'fs78', 410)" class="i">state</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs72', 411)" onmouseover="showTip(event, 'fs72', 411)" class="i">tick</span> <span onmouseout="hideTip(event, 'fs119', 412)" onmouseover="showTip(event, 'fs119', 412)" class="i">delta</span> {<span onmouseout="hideTip(event, 'fs78', 413)" onmouseover="showTip(event, 'fs78', 413)" class="i">state</span> <span class="k">with</span> <span class="i">Elapsed</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs78', 414)" onmouseover="showTip(event, 'fs78', 414)" class="i">state</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 415)" onmouseover="showTip(event, 'fs67', 415)" class="i">Elapsed</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs119', 416)" onmouseover="showTip(event, 'fs119', 416)" class="i">delta</span>}
            <span onmouseout="hideTip(event, 'fs78', 417)" onmouseover="showTip(event, 'fs78', 417)" class="i">state</span></pre>
</td>
</tr>
</table>

<p>Phew! That covered a lot of code in a pretty dense format so I hope you managed to keep up.</p>

<p>The code above gives us pretty much all we need to start creating an actual animation.</p>

<h2>Creating an animation</h2>

<p>In order to create an animation we need to tackle two parts.</p>

<ul>
<li>The creation of a UI, complete with some rendering logic.</li>
<li>The creation of a set of specific emitters, colliders, forces and particle types to implement the animation logic itself.</li>
</ul>

<p>We will start by setting up an instance of our animation type to represent snow.</p>

<h3>It's Snowtime!</h3>

<p>First up, we need to tackle our representation of a snowflake and create an emitter in order to initialise an instance of it.</p>

<p>We make use of the box emitter we saw earlier to define an emitter that generates random starting coordinates from within the given bounds.
By defining the bounds to start above and to the left of the view port, we can make some of our snowflakes appear to be falling from above the screen.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs151', 541)" onmouseover="showTip(event, 'fs151', 541)" class="i">BoxEmitter</span> <span onmouseout="hideTip(event, 'fs108', 542)" onmouseover="showTip(event, 'fs108', 542)" class="i">min</span> <span onmouseout="hideTip(event, 'fs109', 543)" onmouseover="showTip(event, 'fs109', 543)" class="i">max</span> <span class="o">=</span> 
        <span class="k">fun</span> () <span class="k">-&gt;</span> { <span onmouseout="hideTip(event, 'fs5', 544)" onmouseover="showTip(event, 'fs5', 544)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 545)" onmouseover="showTip(event, 'fs6', 545)" class="i">float</span> (<span onmouseout="hideTip(event, 'fs150', 546)" onmouseover="showTip(event, 'fs150', 546)" class="i">rand</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs136', 547)" onmouseover="showTip(event, 'fs136', 547)" class="i">Next</span>(<span onmouseout="hideTip(event, 'fs137', 548)" onmouseover="showTip(event, 'fs137', 548)" class="i">int</span> <span onmouseout="hideTip(event, 'fs108', 549)" onmouseover="showTip(event, 'fs108', 549)" class="i">min</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 550)" onmouseover="showTip(event, 'fs5', 550)" class="i">X</span>, <span onmouseout="hideTip(event, 'fs137', 551)" onmouseover="showTip(event, 'fs137', 551)" class="i">int</span> <span onmouseout="hideTip(event, 'fs109', 552)" onmouseover="showTip(event, 'fs109', 552)" class="i">max</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 553)" onmouseover="showTip(event, 'fs5', 553)" class="i">X</span>))
                    <span onmouseout="hideTip(event, 'fs7', 554)" onmouseover="showTip(event, 'fs7', 554)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 555)" onmouseover="showTip(event, 'fs6', 555)" class="i">float</span> (<span onmouseout="hideTip(event, 'fs150', 556)" onmouseover="showTip(event, 'fs150', 556)" class="i">rand</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs136', 557)" onmouseover="showTip(event, 'fs136', 557)" class="i">Next</span>(<span onmouseout="hideTip(event, 'fs137', 558)" onmouseover="showTip(event, 'fs137', 558)" class="i">int</span> <span onmouseout="hideTip(event, 'fs108', 559)" onmouseover="showTip(event, 'fs108', 559)" class="i">min</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 560)" onmouseover="showTip(event, 'fs7', 560)" class="i">Y</span>, <span onmouseout="hideTip(event, 'fs137', 561)" onmouseover="showTip(event, 'fs137', 561)" class="i">int</span> <span onmouseout="hideTip(event, 'fs109', 562)" onmouseover="showTip(event, 'fs109', 562)" class="i">max</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 563)" onmouseover="showTip(event, 'fs7', 563)" class="i">Y</span>)) }

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs152', 564)" onmouseover="showTip(event, 'fs152', 564)" class="i">emitter</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs151', 565)" onmouseover="showTip(event, 'fs151', 565)" class="i">BoxEmitter</span> {<span onmouseout="hideTip(event, 'fs5', 566)" onmouseover="showTip(event, 'fs5', 566)" class="i">X</span> <span class="o">=</span> <span class="o">-</span><span class="n">50.0</span>; <span onmouseout="hideTip(event, 'fs7', 567)" onmouseover="showTip(event, 'fs7', 567)" class="i">Y</span><span class="o">=</span> <span class="o">-</span><span class="n">40.0</span>} {<span onmouseout="hideTip(event, 'fs5', 568)" onmouseover="showTip(event, 'fs5', 568)" class="i">X</span> <span class="o">=</span> <span class="n">1280.0</span>; <span onmouseout="hideTip(event, 'fs7', 569)" onmouseover="showTip(event, 'fs7', 569)" class="i">Y</span><span class="o">=</span><span class="n">100.0</span>}</pre>
</td>
</tr>
</table>

<p>We will the use this emitter in or snowflake generator function.<br />
This function basically just generates some random values for the important properties of the particle.</p>

<p>Let's run through some of these quickly and describe there usage.</p>

<ul>
<li>Coords: The initial coordinates created by our box emitter.</li>
<li>life/TimeToLive: These values control how long the particle should live for.</li>
<li>Mass: Used in the acceleration calculation. We use a random value between 0.002 and 0.003.</li>
<li>Alpha/AlphaTarget - Control the alpha of the particle in the UI</li>
<li>Velocity: A vector representing the particles initial direction and speed</li>
<li>Acceleration: Starts at zero</li>
<li>Rotation: Starting particle rotation in degrees</li>
<li>AngularVelocity: How quickly the particle rotates around a fixed axis</li>
<li>Scale: A random scale between 0.5 and 1 to give the particles random size</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs153', 570)" onmouseover="showTip(event, 'fs153', 570)" class="i">CreateSnowFlake</span> () <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs141', 571)" onmouseover="showTip(event, 'fs141', 571)" class="i">life</span> <span class="o">=</span> <span class="n">4.0</span> <span class="o">*</span> (<span onmouseout="hideTip(event, 'fs150', 572)" onmouseover="showTip(event, 'fs150', 572)" class="i">rand</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs142', 573)" onmouseover="showTip(event, 'fs142', 573)" class="i">NextDouble</span>() <span class="o">*</span> <span class="n">2.0</span>)
        { <span class="i">Coords</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs152', 574)" onmouseover="showTip(event, 'fs152', 574)" class="i">emitter</span> ()
          <span class="i">Img</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">SnowFlake</span><span class="s">.</span><span class="s">png</span><span class="s">&quot;</span>
          <span class="i">Mass</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs150', 575)" onmouseover="showTip(event, 'fs150', 575)" class="i">rand</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs142', 576)" onmouseover="showTip(event, 'fs142', 576)" class="i">NextDouble</span>() <span class="o">/</span> <span class="n">1000.0</span>) <span class="o">+</span> <span class="n">0.001</span>
          <span class="i">Alpha</span> <span class="o">=</span> <span class="n">1.0</span>
          <span class="i">AlphaTarget</span> <span class="o">=</span> <span class="n">1.0</span>
          <span class="i">Velocity</span> <span class="o">=</span> { <span class="i">Radius</span> <span class="o">=</span> <span class="n">30.0</span>; 
                       <span class="i">Theta</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs150', 577)" onmouseover="showTip(event, 'fs150', 577)" class="i">rand</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs142', 578)" onmouseover="showTip(event, 'fs142', 578)" class="i">NextDouble</span>() <span class="o">*</span> <span onmouseout="hideTip(event, 'fs21', 579)" onmouseover="showTip(event, 'fs21', 579)" class="i">Math</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 580)" onmouseover="showTip(event, 'fs29', 580)" class="i">PI</span> <span class="o">*</span> <span class="n">2.0</span>}
                       <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 581)" onmouseover="showTip(event, 'fs23', 581)" class="i">toCartesian</span>
          <span class="i">AngularVelocity</span> <span class="o">=</span> <span class="n">1.0</span>
          <span class="i">Acceleration</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 582)" onmouseover="showTip(event, 'fs11', 582)" class="i">defaultVector</span>
          <span class="i">TimeToLive</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs141', 583)" onmouseover="showTip(event, 'fs141', 583)" class="i">life</span>
          <span class="i">Life</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs141', 584)" onmouseover="showTip(event, 'fs141', 584)" class="i">life</span>
          <span class="i">Rotation</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs21', 585)" onmouseover="showTip(event, 'fs21', 585)" class="i">Math</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 586)" onmouseover="showTip(event, 'fs29', 586)" class="i">PI</span> <span class="o">*</span> <span class="n">2.0</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs150', 587)" onmouseover="showTip(event, 'fs150', 587)" class="i">rand</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs142', 588)" onmouseover="showTip(event, 'fs142', 588)" class="i">NextDouble</span>()) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs27', 589)" onmouseover="showTip(event, 'fs27', 589)" class="i">toDegrees</span>
          <span class="i">Scale</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs150', 590)" onmouseover="showTip(event, 'fs150', 590)" class="i">rand</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs142', 591)" onmouseover="showTip(event, 'fs142', 591)" class="i">NextDouble</span>() <span class="o">/</span> <span class="n">2.0</span> <span class="o">+</span> <span class="n">0.5</span> 
          <span class="i">Locked</span> <span class="o">=</span> <span class="k">false</span>} </pre>
</td>
</tr>
</table>

<p>Pretty straight forward!</p>

<p>Next up. Forces.<br />
We want our snow flakes to look as realistic as possible (while maintaining simplicity).<br />
We can go some way to achieving this by applying gravity and wind forces in order to give the snow flakes more dynamic movement.</p>

<p>Gravity is a widely adjusted value based upon that of the earth and wind starts as a gentle breeze. (The wind force will change later)</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs154', 592)" onmouseover="showTip(event, 'fs154', 592)" class="i">gravity</span> <span onmouseout="hideTip(event, 'fs155', 593)" onmouseover="showTip(event, 'fs155', 593)" class="i">p</span> <span class="o">=</span> {<span onmouseout="hideTip(event, 'fs5', 594)" onmouseover="showTip(event, 'fs5', 594)" class="i">X</span> <span class="o">=</span> <span class="n">0.0</span>; <span onmouseout="hideTip(event, 'fs7', 595)" onmouseover="showTip(event, 'fs7', 595)" class="i">Y</span> <span class="o">=</span> <span class="n">9.81</span> <span class="o">/</span> <span class="n">60.0</span>}
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs156', 596)" onmouseover="showTip(event, 'fs156', 596)" class="i">wind</span> <span onmouseout="hideTip(event, 'fs155', 597)" onmouseover="showTip(event, 'fs155', 597)" class="i">p</span> <span class="o">=</span> {<span onmouseout="hideTip(event, 'fs5', 598)" onmouseover="showTip(event, 'fs5', 598)" class="i">X</span> <span class="o">=</span> <span class="n">0.5</span>; <span onmouseout="hideTip(event, 'fs7', 599)" onmouseover="showTip(event, 'fs7', 599)" class="i">Y</span> <span class="o">=</span> <span class="n">0.0</span>}</pre>
</td>
</tr>
</table>

<p>Finally we need a tick (or update) function that can be called during iterations of the simulation loop.<br />
This tick function is called from within the main engine tick function and therefore only needs specific logic for this animation.</p>

<p>A perfect place to update the the forces in play. Especially the wind.</p>

<p>Particular notice should be given to how wind force is calculated.<br />
I have based each axis value on a sine wave (or rather half of it in the case of the X axis).
This creates a pleasing effect by slightly altering the strength and direction of the wind smoothly over time.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs157', 600)" onmouseover="showTip(event, 'fs157', 600)" class="i">tick</span> <span onmouseout="hideTip(event, 'fs144', 601)" onmouseover="showTip(event, 'fs144', 601)" class="i">delta</span> <span onmouseout="hideTip(event, 'fs120', 602)" onmouseover="showTip(event, 'fs120', 602)" class="i">state</span> <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs158', 603)" onmouseover="showTip(event, 'fs158', 603)" class="i">wind</span> <span class="o">=</span> <span class="k">fun</span> _ <span class="k">-&gt;</span> { <span onmouseout="hideTip(event, 'fs5', 604)" onmouseover="showTip(event, 'fs5', 604)" class="i">X</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs21', 605)" onmouseover="showTip(event, 'fs21', 605)" class="i">Math</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 606)" onmouseover="showTip(event, 'fs26', 606)" class="i">Sin</span> <span onmouseout="hideTip(event, 'fs120', 607)" onmouseover="showTip(event, 'fs120', 607)" class="i">state</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 608)" onmouseover="showTip(event, 'fs67', 608)" class="i">Elapsed</span> <span class="o">*</span> <span class="n">0.5</span> <span class="o">+</span> <span class="n">0.5</span>) <span class="o">/</span> <span class="n">10.0</span>;
                              <span onmouseout="hideTip(event, 'fs7', 609)" onmouseover="showTip(event, 'fs7', 609)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 610)" onmouseover="showTip(event, 'fs21', 610)" class="i">Math</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 611)" onmouseover="showTip(event, 'fs26', 611)" class="i">Sin</span>(<span onmouseout="hideTip(event, 'fs120', 612)" onmouseover="showTip(event, 'fs120', 612)" class="i">state</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 613)" onmouseover="showTip(event, 'fs67', 613)" class="i">Elapsed</span> <span class="o">*</span> <span class="n">0.5</span>) <span class="o">/</span> <span class="n">10.0</span>}
        { <span onmouseout="hideTip(event, 'fs120', 614)" onmouseover="showTip(event, 'fs120', 614)" class="i">state</span> <span class="k">with</span> <span class="i">Forces</span> <span class="o">=</span> [<span onmouseout="hideTip(event, 'fs154', 615)" onmouseover="showTip(event, 'fs154', 615)" class="i">gravity</span>; <span onmouseout="hideTip(event, 'fs158', 616)" onmouseover="showTip(event, 'fs158', 616)" class="i">wind</span>]}</pre>
</td>
</tr>
</table>

<p>We could also set the colliders here but as we only have our floor collider that we saw earlier, there is no need.</p>

<p>The last thing we need to do, is create the animation instance passing in the required parameters.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs160', 620)" onmouseover="showTip(event, 'fs160', 620)" class="i">Animation</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs160', 621)" onmouseover="showTip(event, 'fs160', 621)" class="i">Animation</span>(<span class="n">10.0</span>, <span class="n">1000</span>, <span onmouseout="hideTip(event, 'fs153', 622)" onmouseover="showTip(event, 'fs153', 622)" class="i">CreateSnowFlake</span>, <span onmouseout="hideTip(event, 'fs157', 623)" onmouseover="showTip(event, 'fs157', 623)" class="i">tick</span>, [<span onmouseout="hideTip(event, 'fs154', 624)" onmouseover="showTip(event, 'fs154', 624)" class="i">gravity</span>; <span onmouseout="hideTip(event, 'fs156', 625)" onmouseover="showTip(event, 'fs156', 625)" class="i">wind</span>], [<span onmouseout="hideTip(event, 'fs149', 626)" onmouseover="showTip(event, 'fs149', 626)" class="i">floorCollider</span>]) </pre>
</td>
</tr>
</table>

<p>That's it! Our animation is now ready to be run.<br />
But hold on a minute! we're going to need some form of UI to show the results and that is where I turn to WPF.</p>

<h2>The Renderer</h2>

<p>As I mentioned at the beginning of the post, WPF is really not a good choice for particle animation.<br />
However, it should hold up to the abuse we're about to throw at it, provided we allow for a degree of mutability and alter our approach ever so slightly in order to keep things smooth (As smooth as it can be!).</p>

<p>For the renderer implementation, We will make use of <a href="https://github.com/fsprojects/FsXaml">FsXaml</a> and <a href="https://github.com/fsprojects/FSharp.ViewModule">FSharp.ViewModule</a>.<br />
The reason for this is two fold. They are familiar; They greatly speed up development time.</p>

<p>I won't go too much into these projects here but I have other <a href="http://stevenpemberton.net/archive/tags/WPF.html">posts</a> on my blog that explain some of the details.</p>

<p>So, where do we start?</p>

<p>The control loop is a good base point.</p>

<h3>The Animation Loop</h3>

<p>An animation loop is a simple beast at it's core, but can become complex when striving to keep things running smoothly on machines of varying performance.<br />
Luckily, as we saw earlier, just by taking into account delta time, we go someway towards this goal without making things too complex.</p>

<p>Let's start by creating a View Model to house our animation control logic. Within which, we will create our loop.<br />
As we are using WPF, I found the easiest way to create a loop was to utilise a <code>DispatchTimer</code> as this plays nicely with WPFs own rendering engine.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs179', 768)" onmouseover="showTip(event, 'fs179', 768)" class="i">MainViewModel</span>() <span class="k">as</span> <span onmouseout="hideTip(event, 'fs179', 769)" onmouseover="showTip(event, 'fs179', 769)" class="i">this</span> <span class="o">=</span> 
        <span class="k">inherit</span> <span onmouseout="hideTip(event, 'fs179', 770)" onmouseover="showTip(event, 'fs179', 770)" class="i">EventViewModelBase</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs179', 771)" onmouseover="showTip(event, 'fs179', 771)" class="i">EngineEvent</span><span class="o">&gt;</span>() 
    
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 772)" onmouseover="showTip(event, 'fs179', 772)" class="i">frameTimer</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs179', 773)" onmouseover="showTip(event, 'fs179', 773)" class="i">DispatcherTimer</span>()</pre>
</td>
</tr>
</table>

<p>We now need to attach an event handler to the 'Tick' of the timer.<br />
This is where we will update both the simulation and the UI.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 839)" onmouseover="showTip(event, 'fs179', 839)" class="i">onTick</span> (_, <span onmouseout="hideTip(event, 'fs179', 840)" onmouseover="showTip(event, 'fs179', 840)" class="i">elapsed</span>) <span class="o">=</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs196', 841)" onmouseover="showTip(event, 'fs196', 841)" class="i">snowState</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs174', 842)" onmouseover="showTip(event, 'fs174', 842)" class="i">Snow</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs187', 843)" onmouseover="showTip(event, 'fs187', 843)" class="i">Animation</span><span class="o">.</span><span class="i">Update</span> <span onmouseout="hideTip(event, 'fs197', 844)" onmouseover="showTip(event, 'fs197', 844)" class="i">elapsed</span>
            <span onmouseout="hideTip(event, 'fs196', 845)" onmouseover="showTip(event, 'fs196', 845)" class="i">snowState</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs62', 846)" onmouseover="showTip(event, 'fs62', 846)" class="i">Particles</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs198', 847)" onmouseover="showTip(event, 'fs198', 847)" class="i">updateParticleUI</span> <span onmouseout="hideTip(event, 'fs199', 848)" onmouseover="showTip(event, 'fs199', 848)" class="i">particles</span></pre>
</td>
</tr>
</table>

<p>The onTick function takes a tuple comprised of the current tick time and the total elapsed time.<br />
All this tick function does is call update on the Snow animation and then update the UI to render the result.</p>

<p><em>You will have noticed the call to updateParticleUI above, we will get to that shortly.</em></p>

<p>First let's look at how we attach this function to the loop.<br />
The constructor of our view model is a good place for this as it means the animation will auto start.</p>

<p>To start with we pass the <code>frameTimer.Tick</code> IEvent to the scan function of the observable module.
This allows us to capture some state on each tick and is how we go about getting the current time and the elapsed time (in seconds), without needing to hold mutable variables outside the handlers.<br />
This is all done with the use of the current tick count. (For those that don't know, it is the time in milliseconds since the computer last started)</p>

<p>The returned observable function is then passed to <code>Observable.subscribe</code> and given our onTick function to call on each observation.<br />
Finally we set the tick interval so that it fires 60 times a second and start the timer.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">do</span>
            <span onmouseout="hideTip(event, 'fs200', 849)" onmouseover="showTip(event, 'fs200', 849)" class="i">frameTimer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs201', 850)" onmouseover="showTip(event, 'fs201', 850)" class="i">Tick</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs165', 851)" onmouseover="showTip(event, 'fs165', 851)" class="i">Observable</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs202', 852)" onmouseover="showTip(event, 'fs202', 852)" class="i">scan</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs179', 853)" onmouseover="showTip(event, 'fs179', 853)" class="i">previous</span>, <span onmouseout="hideTip(event, 'fs179', 854)" onmouseover="showTip(event, 'fs179', 854)" class="i">elapsed</span>) _  <span class="k">-&gt;</span> 
                (<span onmouseout="hideTip(event, 'fs6', 855)" onmouseover="showTip(event, 'fs6', 855)" class="i">float</span> <span onmouseout="hideTip(event, 'fs203', 856)" onmouseover="showTip(event, 'fs203', 856)" class="i">Environment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs204', 857)" onmouseover="showTip(event, 'fs204', 857)" class="i">TickCount</span>, (<span onmouseout="hideTip(event, 'fs6', 858)" onmouseover="showTip(event, 'fs6', 858)" class="i">float</span> <span onmouseout="hideTip(event, 'fs203', 859)" onmouseover="showTip(event, 'fs203', 859)" class="i">Environment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs204', 860)" onmouseover="showTip(event, 'fs204', 860)" class="i">TickCount</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs205', 861)" onmouseover="showTip(event, 'fs205', 861)" class="i">previous</span>) <span class="o">/</span> <span class="n">1000.0</span>)) 
                (<span onmouseout="hideTip(event, 'fs179', 862)" onmouseover="showTip(event, 'fs179', 862)" class="i">float</span> <span onmouseout="hideTip(event, 'fs179', 863)" onmouseover="showTip(event, 'fs179', 863)" class="i">Environment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 864)" onmouseover="showTip(event, 'fs179', 864)" class="i">TickCount</span>, <span onmouseout="hideTip(event, 'fs179', 865)" onmouseover="showTip(event, 'fs179', 865)" class="i">float</span> <span onmouseout="hideTip(event, 'fs179', 866)" onmouseover="showTip(event, 'fs179', 866)" class="i">Environment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 867)" onmouseover="showTip(event, 'fs179', 867)" class="i">TickCount</span>)
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs179', 868)" onmouseover="showTip(event, 'fs179', 868)" class="i">Observable</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs166', 869)" onmouseover="showTip(event, 'fs166', 869)" class="i">subscribe</span> <span onmouseout="hideTip(event, 'fs179', 870)" onmouseover="showTip(event, 'fs179', 870)" class="i">onTick</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs179', 871)" onmouseover="showTip(event, 'fs179', 871)" class="i">ignore</span>
            <span onmouseout="hideTip(event, 'fs179', 872)" onmouseover="showTip(event, 'fs179', 872)" class="i">frameTimer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 873)" onmouseover="showTip(event, 'fs179', 873)" class="i">Interval</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs179', 874)" onmouseover="showTip(event, 'fs179', 874)" class="i">TimeSpan</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 875)" onmouseover="showTip(event, 'fs179', 875)" class="i">FromSeconds</span>(<span class="n">1.0</span> <span class="o">/</span> <span class="n">60.0</span>);
            <span onmouseout="hideTip(event, 'fs179', 876)" onmouseover="showTip(event, 'fs179', 876)" class="i">frameTimer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 877)" onmouseover="showTip(event, 'fs179', 877)" class="i">Start</span>();</pre>
</td>
</tr>
</table>

<h3>Handling UI Updates</h3>

<p>We saw earlier that we need to update the UI on each tick.<br />
Before we can do this we need to create a UI to update!</p>

<p>So let's look at what's needed.</p>

<ul>
<li>A Particle ViewModel. We use this to prevent adding mutability to the engines representation and to speed things up on the rendering side</li>
<li>An observable collection to hold our particles</li>
<li>A UI representation of a particle. This will be an image in our case representing the particle texture</li>
<li>A canvas or other UI component in order to display the particles</li>
</ul>

<p>As usual we can look at each of these in turn.</p>

<p>For the ViewModel I will make use of <code>FSharp.ViewModules</code> <code>BaseViewModel</code> class in order to take advantage of its implementation of <code>INotifyPropertyChanged</code>.<br />
This means my UI can bind straight onto its properties and update itself automatically on each tick. (One benefit of using WPF!)</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs179', 675)" onmouseover="showTip(event, 'fs179', 675)" class="i">ParticleViewModel</span>(<span onmouseout="hideTip(event, 'fs180', 676)" onmouseover="showTip(event, 'fs180', 676)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs181', 677)" onmouseover="showTip(event, 'fs181', 677)" class="i">y</span>,<span onmouseout="hideTip(event, 'fs179', 678)" onmouseover="showTip(event, 'fs179', 678)" class="i">scale</span>,<span onmouseout="hideTip(event, 'fs179', 679)" onmouseover="showTip(event, 'fs179', 679)" class="i">rotation</span>,<span onmouseout="hideTip(event, 'fs179', 680)" onmouseover="showTip(event, 'fs179', 680)" class="i">alpha</span>) <span class="k">as</span> <span onmouseout="hideTip(event, 'fs179', 681)" onmouseover="showTip(event, 'fs179', 681)" class="i">this</span> <span class="o">=</span> 
        <span class="k">inherit</span> <span onmouseout="hideTip(event, 'fs179', 682)" onmouseover="showTip(event, 'fs179', 682)" class="i">ViewModelBase</span>()
    
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 683)" onmouseover="showTip(event, 'fs179', 683)" class="i">rotation</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 684)" onmouseover="showTip(event, 'fs179', 684)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 685)" onmouseover="showTip(event, 'fs179', 685)" class="i">Factory</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 686)" onmouseover="showTip(event, 'fs179', 686)" class="i">Backing</span>(&lt;@<span onmouseout="hideTip(event, 'fs179', 687)" onmouseover="showTip(event, 'fs179', 687)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 688)" onmouseover="showTip(event, 'fs179', 688)" class="i">Rotation</span>@&gt;, <span onmouseout="hideTip(event, 'fs179', 689)" onmouseover="showTip(event, 'fs179', 689)" class="i">rotation</span>)
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 690)" onmouseover="showTip(event, 'fs179', 690)" class="i">scale</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 691)" onmouseover="showTip(event, 'fs179', 691)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 692)" onmouseover="showTip(event, 'fs179', 692)" class="i">Factory</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 693)" onmouseover="showTip(event, 'fs179', 693)" class="i">Backing</span>(&lt;@<span onmouseout="hideTip(event, 'fs179', 694)" onmouseover="showTip(event, 'fs179', 694)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 695)" onmouseover="showTip(event, 'fs179', 695)" class="i">Scale</span>@&gt;, <span onmouseout="hideTip(event, 'fs179', 696)" onmouseover="showTip(event, 'fs179', 696)" class="i">scale</span>)
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 697)" onmouseover="showTip(event, 'fs179', 697)" class="i">alpha</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 698)" onmouseover="showTip(event, 'fs179', 698)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 699)" onmouseover="showTip(event, 'fs179', 699)" class="i">Factory</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 700)" onmouseover="showTip(event, 'fs179', 700)" class="i">Backing</span>(&lt;@<span onmouseout="hideTip(event, 'fs179', 701)" onmouseover="showTip(event, 'fs179', 701)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 702)" onmouseover="showTip(event, 'fs179', 702)" class="i">Alpha</span>@&gt;, <span onmouseout="hideTip(event, 'fs179', 703)" onmouseover="showTip(event, 'fs179', 703)" class="i">alpha</span>)
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs182', 704)" onmouseover="showTip(event, 'fs182', 704)" class="i">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 705)" onmouseover="showTip(event, 'fs179', 705)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 706)" onmouseover="showTip(event, 'fs179', 706)" class="i">Factory</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 707)" onmouseover="showTip(event, 'fs179', 707)" class="i">Backing</span>(&lt;@<span onmouseout="hideTip(event, 'fs179', 708)" onmouseover="showTip(event, 'fs179', 708)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 709)" onmouseover="showTip(event, 'fs179', 709)" class="i">X</span>@&gt;, <span onmouseout="hideTip(event, 'fs179', 710)" onmouseover="showTip(event, 'fs179', 710)" class="i">x</span>)
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs183', 711)" onmouseover="showTip(event, 'fs183', 711)" class="i">y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 712)" onmouseover="showTip(event, 'fs179', 712)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 713)" onmouseover="showTip(event, 'fs179', 713)" class="i">Factory</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 714)" onmouseover="showTip(event, 'fs179', 714)" class="i">Backing</span>(&lt;@<span onmouseout="hideTip(event, 'fs179', 715)" onmouseover="showTip(event, 'fs179', 715)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 716)" onmouseover="showTip(event, 'fs179', 716)" class="i">Y</span>@&gt;, <span onmouseout="hideTip(event, 'fs179', 717)" onmouseover="showTip(event, 'fs179', 717)" class="i">y</span>)
    
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs179', 718)" onmouseover="showTip(event, 'fs179', 718)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 719)" onmouseover="showTip(event, 'fs179', 719)" class="i">Rotation</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs179', 720)" onmouseover="showTip(event, 'fs179', 720)" class="i">get</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 721)" onmouseover="showTip(event, 'fs179', 721)" class="i">rotation</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 722)" onmouseover="showTip(event, 'fs179', 722)" class="i">Value</span> <span class="k">and</span> <span onmouseout="hideTip(event, 'fs179', 723)" onmouseover="showTip(event, 'fs179', 723)" class="i">set</span> (<span onmouseout="hideTip(event, 'fs184', 724)" onmouseover="showTip(event, 'fs184', 724)" class="i">v</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 725)" onmouseover="showTip(event, 'fs179', 725)" class="i">rotation</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 726)" onmouseover="showTip(event, 'fs179', 726)" class="i">Value</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs179', 727)" onmouseover="showTip(event, 'fs179', 727)" class="i">v</span>
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs179', 728)" onmouseover="showTip(event, 'fs179', 728)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 729)" onmouseover="showTip(event, 'fs179', 729)" class="i">Scale</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs179', 730)" onmouseover="showTip(event, 'fs179', 730)" class="i">get</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 731)" onmouseover="showTip(event, 'fs179', 731)" class="i">scale</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 732)" onmouseover="showTip(event, 'fs179', 732)" class="i">Value</span> <span class="k">and</span> <span onmouseout="hideTip(event, 'fs179', 733)" onmouseover="showTip(event, 'fs179', 733)" class="i">set</span> (<span onmouseout="hideTip(event, 'fs184', 734)" onmouseover="showTip(event, 'fs184', 734)" class="i">v</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 735)" onmouseover="showTip(event, 'fs179', 735)" class="i">scale</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 736)" onmouseover="showTip(event, 'fs179', 736)" class="i">Value</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs179', 737)" onmouseover="showTip(event, 'fs179', 737)" class="i">v</span>
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs179', 738)" onmouseover="showTip(event, 'fs179', 738)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 739)" onmouseover="showTip(event, 'fs179', 739)" class="i">Alpha</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs179', 740)" onmouseover="showTip(event, 'fs179', 740)" class="i">get</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 741)" onmouseover="showTip(event, 'fs179', 741)" class="i">alpha</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 742)" onmouseover="showTip(event, 'fs179', 742)" class="i">Value</span> <span class="k">and</span> <span onmouseout="hideTip(event, 'fs179', 743)" onmouseover="showTip(event, 'fs179', 743)" class="i">set</span> (<span onmouseout="hideTip(event, 'fs184', 744)" onmouseover="showTip(event, 'fs184', 744)" class="i">v</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 745)" onmouseover="showTip(event, 'fs179', 745)" class="i">alpha</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 746)" onmouseover="showTip(event, 'fs179', 746)" class="i">Value</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs179', 747)" onmouseover="showTip(event, 'fs179', 747)" class="i">v</span>
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs179', 748)" onmouseover="showTip(event, 'fs179', 748)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs185', 749)" onmouseover="showTip(event, 'fs185', 749)" class="i">X</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs179', 750)" onmouseover="showTip(event, 'fs179', 750)" class="i">get</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs182', 751)" onmouseover="showTip(event, 'fs182', 751)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 752)" onmouseover="showTip(event, 'fs179', 752)" class="i">Value</span> <span class="k">and</span> <span onmouseout="hideTip(event, 'fs179', 753)" onmouseover="showTip(event, 'fs179', 753)" class="i">set</span> (<span onmouseout="hideTip(event, 'fs184', 754)" onmouseover="showTip(event, 'fs184', 754)" class="i">v</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs182', 755)" onmouseover="showTip(event, 'fs182', 755)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 756)" onmouseover="showTip(event, 'fs179', 756)" class="i">Value</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs179', 757)" onmouseover="showTip(event, 'fs179', 757)" class="i">v</span>
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs179', 758)" onmouseover="showTip(event, 'fs179', 758)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs186', 759)" onmouseover="showTip(event, 'fs186', 759)" class="i">Y</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs179', 760)" onmouseover="showTip(event, 'fs179', 760)" class="i">get</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs183', 761)" onmouseover="showTip(event, 'fs183', 761)" class="i">y</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 762)" onmouseover="showTip(event, 'fs179', 762)" class="i">Value</span> <span class="k">and</span> <span onmouseout="hideTip(event, 'fs179', 763)" onmouseover="showTip(event, 'fs179', 763)" class="i">set</span> (<span onmouseout="hideTip(event, 'fs184', 764)" onmouseover="showTip(event, 'fs184', 764)" class="i">v</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs183', 765)" onmouseover="showTip(event, 'fs183', 765)" class="i">y</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 766)" onmouseover="showTip(event, 'fs179', 766)" class="i">Value</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs179', 767)" onmouseover="showTip(event, 'fs179', 767)" class="i">v</span></pre>
</td>
</tr>
</table>

<p>Our MainViewModel can then be given the relevant collection like so and expose it as a member that can be bound to from XAML.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 785)" onmouseover="showTip(event, 'fs179', 785)" class="i">particles</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 786)" onmouseover="showTip(event, 'fs179', 786)" class="i">ObservableCollection</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs179', 787)" onmouseover="showTip(event, 'fs179', 787)" class="i">ParticleViewModel</span><span class="o">&gt;</span>()</pre>
</td>
</tr>
</table>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs206', 878)" onmouseover="showTip(event, 'fs206', 878)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 879)" onmouseover="showTip(event, 'fs179', 879)" class="i">Particles</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs179', 880)" onmouseover="showTip(event, 'fs179', 880)" class="i">ObservableCollection</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs179', 881)" onmouseover="showTip(event, 'fs179', 881)" class="i">ParticleViewModel</span><span class="o">&gt;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 882)" onmouseover="showTip(event, 'fs179', 882)" class="i">particles</span></pre>
</td>
</tr>
</table>

<p>This is then used during the onTick function we defined earlier, in the statement <code>snowState.Particles |&gt; updateParticleUI particles</code></p>

<p>The <code>updateParticleUI</code> function iterates the given collection of particle records and either creates a new <code>ParticleViewModel</code> for the particle if it doesn't exist, or alters an existing ones state.</p>

<p>You will notice that I am relying on the particle lists index in order to locate the correct view model to update.<br />
This is a consequence of a much needed use of mutable data as we cannot rebuild the UI collection due to the massive performance hit that occurs.</p>

<p><em>Note, we need to reverse the list as new particles are always added to start of the particles collection</em></p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 788)" onmouseover="showTip(event, 'fs179', 788)" class="i">updateParticleUI</span> (<span onmouseout="hideTip(event, 'fs179', 789)" onmouseover="showTip(event, 'fs179', 789)" class="i">collection</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs179', 790)" onmouseover="showTip(event, 'fs179', 790)" class="i">ObservableCollection</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs179', 791)" onmouseover="showTip(event, 'fs179', 791)" class="i">ParticleViewModel</span><span class="o">&gt;</span>) <span onmouseout="hideTip(event, 'fs188', 792)" onmouseover="showTip(event, 'fs188', 792)" class="i">particles</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs188', 793)" onmouseover="showTip(event, 'fs188', 793)" class="i">particles</span> 
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 794)" onmouseover="showTip(event, 'fs89', 794)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 795)" onmouseover="showTip(event, 'fs90', 795)" class="i">rev</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 796)" onmouseover="showTip(event, 'fs89', 796)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs189', 797)" onmouseover="showTip(event, 'fs189', 797)" class="i">iteri</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs190', 798)" onmouseover="showTip(event, 'fs190', 798)" class="i">i</span> <span onmouseout="hideTip(event, 'fs97', 799)" onmouseover="showTip(event, 'fs97', 799)" class="i">p</span><span class="k">-&gt;</span> 
                <span class="k">match</span> <span onmouseout="hideTip(event, 'fs190', 800)" onmouseover="showTip(event, 'fs190', 800)" class="i">i</span>,<span onmouseout="hideTip(event, 'fs97', 801)" onmouseover="showTip(event, 'fs97', 801)" class="i">p</span> <span class="k">with</span>
                | <span onmouseout="hideTip(event, 'fs191', 802)" onmouseover="showTip(event, 'fs191', 802)" class="i">x</span>,_ <span class="k">when</span> <span onmouseout="hideTip(event, 'fs190', 803)" onmouseover="showTip(event, 'fs190', 803)" class="i">i</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs192', 804)" onmouseover="showTip(event, 'fs192', 804)" class="i">collection</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs193', 805)" onmouseover="showTip(event, 'fs193', 805)" class="i">Count</span> <span class="k">-&gt;</span>
                    <span onmouseout="hideTip(event, 'fs192', 806)" onmouseover="showTip(event, 'fs192', 806)" class="i">collection</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs190', 807)" onmouseover="showTip(event, 'fs190', 807)" class="i">i</span>]<span class="o">.</span><span class="i">X</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs97', 808)" onmouseover="showTip(event, 'fs97', 808)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 809)" onmouseover="showTip(event, 'fs31', 809)" class="i">Coords</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 810)" onmouseover="showTip(event, 'fs5', 810)" class="i">X</span>
                    <span onmouseout="hideTip(event, 'fs192', 811)" onmouseover="showTip(event, 'fs192', 811)" class="i">collection</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs190', 812)" onmouseover="showTip(event, 'fs190', 812)" class="i">i</span>]<span class="o">.</span><span class="i">Y</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs97', 813)" onmouseover="showTip(event, 'fs97', 813)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 814)" onmouseover="showTip(event, 'fs31', 814)" class="i">Coords</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 815)" onmouseover="showTip(event, 'fs7', 815)" class="i">Y</span>
                    <span onmouseout="hideTip(event, 'fs192', 816)" onmouseover="showTip(event, 'fs192', 816)" class="i">collection</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs190', 817)" onmouseover="showTip(event, 'fs190', 817)" class="i">i</span>]<span class="o">.</span><span class="i">Rotation</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs97', 818)" onmouseover="showTip(event, 'fs97', 818)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 819)" onmouseover="showTip(event, 'fs43', 819)" class="i">Rotation</span>
                    <span onmouseout="hideTip(event, 'fs192', 820)" onmouseover="showTip(event, 'fs192', 820)" class="i">collection</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs190', 821)" onmouseover="showTip(event, 'fs190', 821)" class="i">i</span>]<span class="o">.</span><span class="i">Alpha</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs97', 822)" onmouseover="showTip(event, 'fs97', 822)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs36', 823)" onmouseover="showTip(event, 'fs36', 823)" class="i">Alpha</span>
                | _,_ <span class="k">-&gt;</span>
                    <span onmouseout="hideTip(event, 'fs192', 824)" onmouseover="showTip(event, 'fs192', 824)" class="i">collection</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs194', 825)" onmouseover="showTip(event, 'fs194', 825)" class="i">Add</span>(<span class="k">new</span> <span onmouseout="hideTip(event, 'fs195', 826)" onmouseover="showTip(event, 'fs195', 826)" class="i">ParticleViewModel</span>(<span onmouseout="hideTip(event, 'fs97', 827)" onmouseover="showTip(event, 'fs97', 827)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 828)" onmouseover="showTip(event, 'fs31', 828)" class="i">Coords</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 829)" onmouseover="showTip(event, 'fs5', 829)" class="i">X</span>, <span onmouseout="hideTip(event, 'fs97', 830)" onmouseover="showTip(event, 'fs97', 830)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 831)" onmouseover="showTip(event, 'fs31', 831)" class="i">Coords</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 832)" onmouseover="showTip(event, 'fs7', 832)" class="i">Y</span>,<span onmouseout="hideTip(event, 'fs97', 833)" onmouseover="showTip(event, 'fs97', 833)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs44', 834)" onmouseover="showTip(event, 'fs44', 834)" class="i">Scale</span>,<span onmouseout="hideTip(event, 'fs97', 835)" onmouseover="showTip(event, 'fs97', 835)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 836)" onmouseover="showTip(event, 'fs43', 836)" class="i">Rotation</span>, <span onmouseout="hideTip(event, 'fs97', 837)" onmouseover="showTip(event, 'fs97', 837)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs36', 838)" onmouseover="showTip(event, 'fs36', 838)" class="i">Alpha</span>)))</pre>
</td>
</tr>
</table>

<p>That looks great, onto the UI.</p>

<h3>The XAML View</h3>

<p>In order to display the particles on the screen, we need something light weight in terms of child positioning and that can hold a collection of elements natively.<br />
One solution is to create an items control and set its panel to be a canvas element.</p>

<p>This will then allow us to define a simple data template and accompanying item style in order to display the particles just as we want.</p>

<p>Below is the important section of XAML. The rest can be viewed on <a href="https://github.com/sjpemberton/FsSnowGlobe/">GitHub</a> if interested.</p>

<p>{% highlight xml %}
<ItemsControl ItemsSource="{Binding Particles}">
    <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
            <Canvas xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
            x:Name="Canvas" Grid.Row="0" Width="1280" Height="720" Canvas.Left="0" Canvas.Top="0" Margin="0,0,0,0" Background="Transparent" />
        </ItemsPanelTemplate>
    </ItemsControl.ItemsPanel>
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <Image Source="SnowFlake.png" Width="8" Height="8">
                <Image.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="{Binding Scale}" ScaleY="{Binding Scale}"  />
                        <RotateTransform Angle="{Binding Rotation}" />
                    </TransformGroup>
                </Image.RenderTransform>
            </Image>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
    <ItemsControl.ItemContainerStyle>
        <Style>
            <Setter Property="Canvas.Left" Value="{Binding Path=X}" />
            <Setter Property="Canvas.Top" Value="{Binding Path=Y}" />
            <Setter Property="Image.Opacity" Value="{Binding Alpha}" />
        </Style>
    </ItemsControl.ItemContainerStyle>
</ItemsControl>
{% endhighlight %}</p>

<p>As you can see, the above XAML contains bindings to set the <code>Canvas.Left</code> and <code>Canvas.Right</code> props, along with opacity, scale and rotation, with the latter two inside a render transform on the image element.</p>

<p>This is all we needed to accomplish. The animation should now be in a state to run successfully and render us a happy little snow scene!
But we can go further. Why not have another type of particle animating at the same time? And what about some user interaction?</p>

<h2>Running Two Animations</h2>

<p>Running two animations is an easy task.<br />
All we need is to set up another animation in exactly the same way as we did for the Snow.</p>

<p>That is, implement any emitters, colliders, forces and update logic that are required and instantiate a new Animation using them.<br />
The <code>MainViewModel</code> will also need a slight change to make use of them.</p>

<p>It will require two particle collections and needs to ensure both animations get updated every tick.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs209', 937)" onmouseover="showTip(event, 'fs209', 937)" class="i">particles</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs208', 938)" onmouseover="showTip(event, 'fs208', 938)" class="i">ObservableCollection</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs195', 939)" onmouseover="showTip(event, 'fs195', 939)" class="i">ParticleViewModel</span><span class="o">&gt;</span>() 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs210', 940)" onmouseover="showTip(event, 'fs210', 940)" class="i">mistParticles</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs208', 941)" onmouseover="showTip(event, 'fs208', 941)" class="i">ObservableCollection</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs195', 942)" onmouseover="showTip(event, 'fs195', 942)" class="i">ParticleViewModel</span><span class="o">&gt;</span>() 

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs211', 943)" onmouseover="showTip(event, 'fs211', 943)" class="i">onTick</span> (_, <span onmouseout="hideTip(event, 'fs197', 944)" onmouseover="showTip(event, 'fs197', 944)" class="i">elapsed</span>) <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs196', 945)" onmouseover="showTip(event, 'fs196', 945)" class="i">snowState</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs174', 946)" onmouseover="showTip(event, 'fs174', 946)" class="i">Snow</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs187', 947)" onmouseover="showTip(event, 'fs187', 947)" class="i">Animation</span><span class="o">.</span><span class="i">Update</span> <span onmouseout="hideTip(event, 'fs197', 948)" onmouseover="showTip(event, 'fs197', 948)" class="i">elapsed</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs212', 949)" onmouseover="showTip(event, 'fs212', 949)" class="i">mistState</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs213', 950)" onmouseover="showTip(event, 'fs213', 950)" class="i">Mist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs214', 951)" onmouseover="showTip(event, 'fs214', 951)" class="i">Animation</span><span class="o">.</span><span class="i">Update</span> <span onmouseout="hideTip(event, 'fs197', 952)" onmouseover="showTip(event, 'fs197', 952)" class="i">elapsed</span> 
        <span onmouseout="hideTip(event, 'fs196', 953)" onmouseover="showTip(event, 'fs196', 953)" class="i">snowState</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs62', 954)" onmouseover="showTip(event, 'fs62', 954)" class="i">Particles</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs207', 955)" onmouseover="showTip(event, 'fs207', 955)" class="i">updateParticleUI</span> <span onmouseout="hideTip(event, 'fs209', 956)" onmouseover="showTip(event, 'fs209', 956)" class="i">particles</span>
        <span onmouseout="hideTip(event, 'fs212', 957)" onmouseover="showTip(event, 'fs212', 957)" class="i">mistState</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs62', 958)" onmouseover="showTip(event, 'fs62', 958)" class="i">Particles</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs207', 959)" onmouseover="showTip(event, 'fs207', 959)" class="i">updateParticleUI</span> <span onmouseout="hideTip(event, 'fs210', 960)" onmouseover="showTip(event, 'fs210', 960)" class="i">mistParticles</span></pre>
</td>
</tr>
</table>

<p>The definition of my second animation is incredibly similar to the first.<br />
It differs in the fact is has no specific update logic, has no forces or colliders and is therefore much simpler.</p>

<p>With no colliders or forces, it means the mist particles simply drift across the screen in their initial direction and speed. Perfect!
I've omitted the code for brevity so check it out on <a href="https://github.com/sjpemberton/FsSnowGlobe/blob/master/ParticleEngine/Mist.fs">GitHub</a> if you are intrigued.</p>

<p>To handle the rendering, we will create another <code>ItemsControl</code> with a canvas panel in the UI and overlap the first with it.<br />
That's it, as simple as that!</p>

<p>I won't paste the XAML in here as it is almost identical. Feel free to check it on GitHub <a href="https://github.com/sjpemberton/FsSnowGlobe/blob/master/FsSnowGlobe/MainWindow.xaml">here</a> if you want.</p>

<h2>User Interaction - Events</h2>

<p>Now for the best part. Some user interaction.</p>

<p>For this we need to accomplish a few things.</p>

<ul>
<li>Propagate events from the UI into the engine</li>
<li>Pass these events to the relevant animations</li>
<li>Allow the event handlers to have a causal effect on the particles.</li>
</ul>

<p>Luckily for us, FsXaml provides us with some handy event to command and event converter functionality that we can utilise in order to capture UI events and transform them into <code>EngineEvent</code> records.
The code for an <code>EngineEvent</code> is straight forward, especially as we currently only care about mouse events.<br />
Other cases could be added to this union as required.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs55', 138)" onmouseover="showTip(event, 'fs55', 138)" class="i">MouseButtonStatus</span> <span class="o">=</span> 
        | <span onmouseout="hideTip(event, 'fs56', 139)" onmouseover="showTip(event, 'fs56', 139)" class="i">LeftDown</span>
        | <span onmouseout="hideTip(event, 'fs57', 140)" onmouseover="showTip(event, 'fs57', 140)" class="i">RightDown</span>
        | <span onmouseout="hideTip(event, 'fs58', 141)" onmouseover="showTip(event, 'fs58', 141)" class="i">Released</span>

    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs59', 142)" onmouseover="showTip(event, 'fs59', 142)" class="i">EngineEvent</span> <span class="o">=</span> 
        | <span onmouseout="hideTip(event, 'fs60', 143)" onmouseover="showTip(event, 'fs60', 143)" class="i">MouseEvent</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs55', 144)" onmouseover="showTip(event, 'fs55', 144)" class="i">MouseButtonStatus</span> <span class="o">*</span> <span class="i">position</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 145)" onmouseover="showTip(event, 'fs4', 145)" class="i">Vector</span></pre>
</td>
</tr>
</table>

<p>Next up, we create the usage of this event on the Animation type.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs76', 168)" onmouseover="showTip(event, 'fs76', 168)" class="i">mouseEvent</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs77', 169)" onmouseover="showTip(event, 'fs77', 169)" class="i">Event</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs59', 170)" onmouseover="showTip(event, 'fs59', 170)" class="i">EngineEvent</span><span class="o">&gt;</span>()</pre>
</td>
</tr>
</table>

<p>And finally publish the event to the outside world, along with a convenient raise event member.<br />
These will be our port into the events from the UI code.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs123', 418)" onmouseover="showTip(event, 'fs123', 418)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs125', 419)" onmouseover="showTip(event, 'fs125', 419)" class="i">RaiseMouseEvent</span> <span onmouseout="hideTip(event, 'fs126', 420)" onmouseover="showTip(event, 'fs126', 420)" class="i">status</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs126', 421)" onmouseover="showTip(event, 'fs126', 421)" class="i">status</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs76', 422)" onmouseover="showTip(event, 'fs76', 422)" class="i">mouseEvent</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 423)" onmouseover="showTip(event, 'fs127', 423)" class="i">Trigger</span>
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs123', 424)" onmouseover="showTip(event, 'fs123', 424)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs128', 425)" onmouseover="showTip(event, 'fs128', 425)" class="i">MouseEvent</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs76', 426)" onmouseover="showTip(event, 'fs76', 426)" class="i">mouseEvent</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs129', 427)" onmouseover="showTip(event, 'fs129', 427)" class="i">Publish</span> <span class="o">:&gt;</span> <span onmouseout="hideTip(event, 'fs130', 428)" onmouseover="showTip(event, 'fs130', 428)" class="i">IObservable</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs59', 429)" onmouseover="showTip(event, 'fs59', 429)" class="i">EngineEvent</span><span class="o">&gt;</span></pre>
</td>
</tr>
</table>

<p>That is one half of the problem solved, now let's look at how we bind to them from the UI.<br />
To do this, we will be making use of the event converters from FsXaml.</p>

<p>The basic premise here is to define a function that takes a system <code>MousEventArgs</code> as a parameter and converts it to an instance of our <code>EngineEvent</code>.<br />
Of course, if our <code>EngineEvent</code> union had more cases we would likely need multiple converters to convert from different system event types, from different handlers.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs215', 969)" onmouseover="showTip(event, 'fs215', 969)" class="i">mouseConverter</span> (<span onmouseout="hideTip(event, 'fs216', 970)" onmouseover="showTip(event, 'fs216', 970)" class="i">args</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs217', 971)" onmouseover="showTip(event, 'fs217', 971)" class="i">MouseEventArgs</span>) <span class="o">=</span> 
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs218', 972)" onmouseover="showTip(event, 'fs218', 972)" class="i">status</span> <span class="o">=</span> 
                <span class="k">if</span> <span onmouseout="hideTip(event, 'fs216', 973)" onmouseover="showTip(event, 'fs216', 973)" class="i">args</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs219', 974)" onmouseover="showTip(event, 'fs219', 974)" class="i">LeftButton</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs220', 975)" onmouseover="showTip(event, 'fs220', 975)" class="i">MouseButtonState</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs221', 976)" onmouseover="showTip(event, 'fs221', 976)" class="i">Pressed</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs56', 977)" onmouseover="showTip(event, 'fs56', 977)" class="i">LeftDown</span>
                <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs216', 978)" onmouseover="showTip(event, 'fs216', 978)" class="i">args</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs222', 979)" onmouseover="showTip(event, 'fs222', 979)" class="i">RightButton</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs220', 980)" onmouseover="showTip(event, 'fs220', 980)" class="i">MouseButtonState</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs221', 981)" onmouseover="showTip(event, 'fs221', 981)" class="i">Pressed</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs57', 982)" onmouseover="showTip(event, 'fs57', 982)" class="i">RightDown</span>
                <span class="k">else</span> <span onmouseout="hideTip(event, 'fs58', 983)" onmouseover="showTip(event, 'fs58', 983)" class="i">Released</span>
        
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs223', 984)" onmouseover="showTip(event, 'fs223', 984)" class="i">pt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs216', 985)" onmouseover="showTip(event, 'fs216', 985)" class="i">args</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs224', 986)" onmouseover="showTip(event, 'fs224', 986)" class="i">GetPosition</span>(<span onmouseout="hideTip(event, 'fs216', 987)" onmouseover="showTip(event, 'fs216', 987)" class="i">args</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs225', 988)" onmouseover="showTip(event, 'fs225', 988)" class="i">OriginalSource</span> <span class="o">:?&gt;</span> <span onmouseout="hideTip(event, 'fs226', 989)" onmouseover="showTip(event, 'fs226', 989)" class="i">IInputElement</span>)
            <span onmouseout="hideTip(event, 'fs60', 990)" onmouseover="showTip(event, 'fs60', 990)" class="i">MouseEvent</span>(<span onmouseout="hideTip(event, 'fs218', 991)" onmouseover="showTip(event, 'fs218', 991)" class="i">status</span>, { <span onmouseout="hideTip(event, 'fs5', 992)" onmouseover="showTip(event, 'fs5', 992)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs223', 993)" onmouseover="showTip(event, 'fs223', 993)" class="i">pt</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs227', 994)" onmouseover="showTip(event, 'fs227', 994)" class="i">X</span>; <span onmouseout="hideTip(event, 'fs7', 995)" onmouseover="showTip(event, 'fs7', 995)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs223', 996)" onmouseover="showTip(event, 'fs223', 996)" class="i">pt</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs228', 997)" onmouseover="showTip(event, 'fs228', 997)" class="i">Y</span> })

<span class="c">// The converter to convert from MouseEventArgs -&gt; EngineEvent</span>
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs229', 998)" onmouseover="showTip(event, 'fs229', 998)" class="i">MouseConverter</span>() <span class="o">=</span> 
        <span class="k">inherit</span> <span onmouseout="hideTip(event, 'fs230', 999)" onmouseover="showTip(event, 'fs230', 999)" class="i">EventArgsConverter</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs217', 1000)" onmouseover="showTip(event, 'fs217', 1000)" class="i">MouseEventArgs</span>, <span onmouseout="hideTip(event, 'fs59', 1001)" onmouseover="showTip(event, 'fs59', 1001)" class="i">EngineEvent</span><span class="o">&gt;</span>(<span onmouseout="hideTip(event, 'fs231', 1002)" onmouseover="showTip(event, 'fs231', 1002)" class="i">EventConverters</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs215', 1003)" onmouseover="showTip(event, 'fs215', 1003)" class="i">mouseConverter</span>, <span onmouseout="hideTip(event, 'fs60', 1004)" onmouseover="showTip(event, 'fs60', 1004)" class="i">MouseEvent</span>(<span onmouseout="hideTip(event, 'fs58', 1005)" onmouseover="showTip(event, 'fs58', 1005)" class="i">Released</span>, { <span onmouseout="hideTip(event, 'fs5', 1006)" onmouseover="showTip(event, 'fs5', 1006)" class="i">X</span> <span class="o">=</span> <span class="n">0.0</span>; <span onmouseout="hideTip(event, 'fs7', 1007)" onmouseover="showTip(event, 'fs7', 1007)" class="i">Y</span> <span class="o">=</span> <span class="n">0.0</span> }))</pre>
</td>
</tr>
</table>

<p>In order to utilise this converter we need to add it as a resource to the XAML of our view and then use FsXamls <code>EventToCommand</code> utility in order to bind to a command on our <code>MainViewModel</code>.</p>

<p>This is done using the <code>System.Windows.Interactivity</code> helpers by specifying a trigger on the <code>MouseMove</code> event of the containing Grid element, like so.</p>

<p>{% highlight xml %}
<Window.Resources>
    <events:MouseConverter x:Key="mouseConverter" />
</Window.Resources>
<Grid>
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="MouseMove">
            <fsxaml:EventToCommand Command="{Binding MouseCommand}" EventArgsConverter="{StaticResource mouseConverter}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    ...
    {% endhighlight %}</p>

<p>The arguments for the command flow from the event, through the converter, and to the command.<br />
Hence, we can create our command on the view model to utilise the <code>EngineEvent</code>.</p>

<p>In fact, I have cheated slightly and simply passed the EngineEvent straight from the view model to the snow animation (As this is the animation I want to handle the event in).</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 774)" onmouseover="showTip(event, 'fs179', 774)" class="i">mouseCommand</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 775)" onmouseover="showTip(event, 'fs179', 775)" class="i">FunCommand</span>((<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs179', 776)" onmouseover="showTip(event, 'fs179', 776)" class="i">o</span> <span class="k">-&gt;</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 777)" onmouseover="showTip(event, 'fs179', 777)" class="i">mEvent</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 778)" onmouseover="showTip(event, 'fs179', 778)" class="i">o</span> <span class="o">:?&gt;</span> <span onmouseout="hideTip(event, 'fs179', 779)" onmouseover="showTip(event, 'fs179', 779)" class="i">EngineEvent</span>
            <span onmouseout="hideTip(event, 'fs179', 780)" onmouseover="showTip(event, 'fs179', 780)" class="i">Snow</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs187', 781)" onmouseover="showTip(event, 'fs187', 781)" class="i">Animation</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 782)" onmouseover="showTip(event, 'fs179', 782)" class="i">RaiseMouseEvent</span> <span onmouseout="hideTip(event, 'fs179', 783)" onmouseover="showTip(event, 'fs179', 783)" class="i">mEvent</span>), <span class="k">fun</span> _ <span class="k">-&gt;</span> <span class="k">true</span>) <span class="o">:&gt;</span> <span onmouseout="hideTip(event, 'fs179', 784)" onmouseover="showTip(event, 'fs179', 784)" class="i">ICommand</span></pre>
</td>
</tr>
</table>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs206', 883)" onmouseover="showTip(event, 'fs206', 883)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 884)" onmouseover="showTip(event, 'fs179', 884)" class="i">MouseCommand</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 885)" onmouseover="showTip(event, 'fs179', 885)" class="i">mouseCommand</span></pre>
</td>
</tr>
</table>

<p>Almost there!</p>

<p>The last, but not least task to complete is the actual handling of the <code>EngineEvent</code>.</p>

<p>For my mouse events I want to have different forces applied to the snow particles depending on what button was held down during the moving of the mouse.</p>

<ul>
<li>If the left button is pressed, the particles should be repelled away from the cursors origin</li>
<li>If the right button is pressed, the particles are pulled towards the cursor.</li>
<li>When both buttons are released the force is removed.</li>
</ul>

<p>That sounds simple enough. We just need to pattern match over our <code>EngineEvent</code> and assign a new event to a mutable variable.</p>

<p>We therefore add the following to our snow animation module.</p>

<p>The mutable binding.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span class="k">mutable</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs159', 617)" onmouseover="showTip(event, 'fs159', 617)" class="i">mouseForce</span> <span class="o">=</span> <span class="k">fun</span> _ <span class="k">-&gt;</span> {<span onmouseout="hideTip(event, 'fs5', 618)" onmouseover="showTip(event, 'fs5', 618)" class="i">X</span> <span class="o">=</span> <span class="n">0.0</span>; <span onmouseout="hideTip(event, 'fs7', 619)" onmouseover="showTip(event, 'fs7', 619)" class="i">Y</span> <span class="o">=</span> <span class="n">0.0</span>}</pre>
</td>
</tr>
</table>

<p>The event handler and event subscription.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs161', 627)" onmouseover="showTip(event, 'fs161', 627)" class="i">applyMouseForce</span> <span class="o">=</span> <span class="k">function</span>
    | <span onmouseout="hideTip(event, 'fs60', 628)" onmouseover="showTip(event, 'fs60', 628)" class="i">MouseEvent</span>(<span onmouseout="hideTip(event, 'fs56', 629)" onmouseover="showTip(event, 'fs56', 629)" class="i">LeftDown</span>, <span onmouseout="hideTip(event, 'fs162', 630)" onmouseover="showTip(event, 'fs162', 630)" class="i">currentPos</span>) <span class="k">-&gt;</span>
        <span onmouseout="hideTip(event, 'fs159', 631)" onmouseover="showTip(event, 'fs159', 631)" class="i">mouseForce</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs47', 632)" onmouseover="showTip(event, 'fs47', 632)" class="i">exertForce</span> <span onmouseout="hideTip(event, 'fs162', 633)" onmouseover="showTip(event, 'fs162', 633)" class="i">currentPos</span> <span class="n">200.0</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs163', 634)" onmouseover="showTip(event, 'fs163', 634)" class="i">d</span> <span class="k">-&gt;</span> <span class="n">1.0</span> <span class="o">/</span> (<span class="n">1.0</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs163', 635)" onmouseover="showTip(event, 'fs163', 635)" class="i">d</span>))
    | <span onmouseout="hideTip(event, 'fs60', 636)" onmouseover="showTip(event, 'fs60', 636)" class="i">MouseEvent</span>(<span onmouseout="hideTip(event, 'fs57', 637)" onmouseover="showTip(event, 'fs57', 637)" class="i">RightDown</span>, <span onmouseout="hideTip(event, 'fs162', 638)" onmouseover="showTip(event, 'fs162', 638)" class="i">currentPos</span>) <span class="k">-&gt;</span>
        <span onmouseout="hideTip(event, 'fs159', 639)" onmouseover="showTip(event, 'fs159', 639)" class="i">mouseForce</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs47', 640)" onmouseover="showTip(event, 'fs47', 640)" class="i">exertForce</span> <span onmouseout="hideTip(event, 'fs162', 641)" onmouseover="showTip(event, 'fs162', 641)" class="i">currentPos</span> <span class="o">-</span><span class="n">200.0</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs163', 642)" onmouseover="showTip(event, 'fs163', 642)" class="i">d</span> <span class="k">-&gt;</span> <span class="n">1.0</span> <span class="o">/</span> (<span class="n">1.0</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs163', 643)" onmouseover="showTip(event, 'fs163', 643)" class="i">d</span>))
    |_ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs159', 644)" onmouseover="showTip(event, 'fs159', 644)" class="i">mouseForce</span> <span class="o">&lt;-</span> <span class="k">fun</span> _ <span class="k">-&gt;</span> {<span onmouseout="hideTip(event, 'fs5', 645)" onmouseover="showTip(event, 'fs5', 645)" class="i">X</span> <span class="o">=</span> <span class="n">0.0</span>; <span onmouseout="hideTip(event, 'fs7', 646)" onmouseover="showTip(event, 'fs7', 646)" class="i">Y</span> <span class="o">=</span> <span class="n">0.0</span>}

    <span class="k">do</span>
        <span onmouseout="hideTip(event, 'fs160', 647)" onmouseover="showTip(event, 'fs160', 647)" class="i">Animation</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs164', 648)" onmouseover="showTip(event, 'fs164', 648)" class="i">MouseEvent</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs165', 649)" onmouseover="showTip(event, 'fs165', 649)" class="i">Observable</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs166', 650)" onmouseover="showTip(event, 'fs166', 650)" class="i">subscribe</span> <span onmouseout="hideTip(event, 'fs161', 651)" onmouseover="showTip(event, 'fs161', 651)" class="i">applyMouseForce</span> 
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs167', 652)" onmouseover="showTip(event, 'fs167', 652)" class="i">ignore</span></pre>
</td>
</tr>
</table>

<p><em>Keen readers will be wondering what the <code>exertForce</code> function does, so here it is</em></p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs47', 109)" onmouseover="showTip(event, 'fs47', 109)" class="i">exertForce</span> <span onmouseout="hideTip(event, 'fs48', 110)" onmouseover="showTip(event, 'fs48', 110)" class="i">epicentre</span> <span onmouseout="hideTip(event, 'fs49', 111)" onmouseover="showTip(event, 'fs49', 111)" class="i">strength</span> <span onmouseout="hideTip(event, 'fs50', 112)" onmouseover="showTip(event, 'fs50', 112)" class="i">decayF</span> <span onmouseout="hideTip(event, 'fs20', 113)" onmouseover="showTip(event, 'fs20', 113)" class="i">vec</span> <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs51', 114)" onmouseover="showTip(event, 'fs51', 114)" class="i">diff</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs48', 115)" onmouseover="showTip(event, 'fs48', 115)" class="i">epicentre</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs51', 116)" onmouseover="showTip(event, 'fs51', 116)" class="i">diff</span> <span onmouseout="hideTip(event, 'fs20', 117)" onmouseover="showTip(event, 'fs20', 117)" class="i">vec</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs52', 118)" onmouseover="showTip(event, 'fs52', 118)" class="i">distance</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 119)" onmouseover="showTip(event, 'fs16', 119)" class="i">magnitude</span> <span onmouseout="hideTip(event, 'fs51', 120)" onmouseover="showTip(event, 'fs51', 120)" class="i">diff</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 121)" onmouseover="showTip(event, 'fs53', 121)" class="i">decay</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs50', 122)" onmouseover="showTip(event, 'fs50', 122)" class="i">decayF</span> <span onmouseout="hideTip(event, 'fs52', 123)" onmouseover="showTip(event, 'fs52', 123)" class="i">distance</span>
        { <span onmouseout="hideTip(event, 'fs5', 124)" onmouseover="showTip(event, 'fs5', 124)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs51', 125)" onmouseover="showTip(event, 'fs51', 125)" class="i">diff</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 126)" onmouseover="showTip(event, 'fs5', 126)" class="i">X</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs52', 127)" onmouseover="showTip(event, 'fs52', 127)" class="i">distance</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs53', 128)" onmouseover="showTip(event, 'fs53', 128)" class="i">decay</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs49', 129)" onmouseover="showTip(event, 'fs49', 129)" class="i">strength</span>
          <span onmouseout="hideTip(event, 'fs7', 130)" onmouseover="showTip(event, 'fs7', 130)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs51', 131)" onmouseover="showTip(event, 'fs51', 131)" class="i">diff</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 132)" onmouseover="showTip(event, 'fs7', 132)" class="i">Y</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs52', 133)" onmouseover="showTip(event, 'fs52', 133)" class="i">distance</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs53', 134)" onmouseover="showTip(event, 'fs53', 134)" class="i">decay</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs49', 135)" onmouseover="showTip(event, 'fs49', 135)" class="i">strength</span> }
      </pre>
</td>
</tr>
</table>

<p>It takes an epicentre for the force, strength, a decay function and a vector.<br />
It then calculates how much force to apply to the vector based on the distance form the epicentre and the decay function. The result is particles closer to the epicentre have more force exerted on them than those farther away.</p>

<p>That's it, everything is in place.<br />
The .gif below shows the interactivity in action.</p>

<video autoplay controls loop poster="/content/images/post-images/fsAdventInteractive.jpg" src="/content/images/post-images/fsAdventInteractive.webm">
Sorry, your browser doesn't support HTML5 video!
Don't worry you can download the video <a href="http://stevenpemberton.net/content/images/post-images/fsAdventInteractive.webm">here</a> and view it in a video player.
Alternatively, you view <a href="http://stevenpemberton.net/content/images/post-images/fsAdventInteractive.gif">this .gif</a> instead.
</video>

<h2>Conclusion</h2>

<p>I hope you enjoyed this simple animation.<br />
It was fun to create and the simplicity of F# made for a relatively quick and painless experience.</p>

<p>I would love to see how it performs when WPF is not being used as the render and I am more than aware of many places where efficiency could be improved in the engine code.</p>

<p>Likewise a much better option would have been to use OpenGL or DirectX for the rendering but the learning curve would have likely been to steep for the time I had. (Possible follow on post in the new year?)</p>

<p>As usual, all the code is available on <a href="https://github.com/sjpemberton/FsSnowGlobe/">GitHub</a> so feel free to check it out!</p>

<p>Thanks again to <a href="https://sergeytihon.wordpress.com/tag/fsadvent/">Sergey Tihon</a> for organising this amazing event.</p>

<div class="tip" id="fs1">Multiple items<br />type AutoOpenAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; AutoOpenAttribute<br />&#160;&#160;new : path:string -&gt; AutoOpenAttribute<br />&#160;&#160;member Path : string<br /><br />Full name: Microsoft.FSharp.Core.AutoOpenAttribute<br /><br />--------------------<br />new : unit -&gt; AutoOpenAttribute<br />new : path:string -&gt; AutoOpenAttribute</div>
<div class="tip" id="fs2">namespace Microsoft.FSharp.Core</div>
<div class="tip" id="fs3">namespace System</div>
<div class="tip" id="fs4">type Vector =<br />&#160;&#160;{X: float;<br />&#160;&#160;&#160;Y: float;}<br /><br />Full name: FsWPF.Core.Vector</div>
<div class="tip" id="fs5">Vector.X: float</div>
<div class="tip" id="fs6">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs7">Vector.Y: float</div>
<div class="tip" id="fs8">type Polar =<br />&#160;&#160;{Radius: float;<br />&#160;&#160;&#160;Theta: float;}<br /><br />Full name: FsWPF.Core.Polar</div>
<div class="tip" id="fs9">Polar.Radius: float</div>
<div class="tip" id="fs10">Polar.Theta: float</div>
<div class="tip" id="fs11">val defaultVector : Vector<br /><br />Full name: FsWPF.Core.defaultVector</div>
<div class="tip" id="fs12">val sum : a:Vector -&gt; b:Vector -&gt; Vector<br /><br />Full name: FsWPF.Core.sum</div>
<div class="tip" id="fs13">val a : Vector</div>
<div class="tip" id="fs14">val b : Vector</div>
<div class="tip" id="fs15">val diff : a:Vector -&gt; b:Vector -&gt; Vector<br /><br />Full name: FsWPF.Core.diff</div>
<div class="tip" id="fs16">val magnitude : vector:Vector -&gt; float<br /><br />Full name: FsWPF.Core.magnitude</div>
<div class="tip" id="fs17">val vector : Vector</div>
<div class="tip" id="fs18">val sqrt : value:&#39;T -&gt; &#39;U (requires member Sqrt)<br /><br />Full name: Microsoft.FSharp.Core.Operators.sqrt</div>
<div class="tip" id="fs19">val toPolar : vec:Vector -&gt; Polar<br /><br />Full name: FsWPF.Core.toPolar</div>
<div class="tip" id="fs20">val vec : Vector</div>
<div class="tip" id="fs21">type Math =<br />&#160;&#160;static val PI : float<br />&#160;&#160;static val E : float<br />&#160;&#160;static member Abs : value:sbyte -&gt; sbyte + 6 overloads<br />&#160;&#160;static member Acos : d:float -&gt; float<br />&#160;&#160;static member Asin : d:float -&gt; float<br />&#160;&#160;static member Atan : d:float -&gt; float<br />&#160;&#160;static member Atan2 : y:float * x:float -&gt; float<br />&#160;&#160;static member BigMul : a:int * b:int -&gt; int64<br />&#160;&#160;static member Ceiling : d:decimal -&gt; decimal + 1 overload<br />&#160;&#160;static member Cos : d:float -&gt; float<br />&#160;&#160;...<br /><br />Full name: System.Math</div>
<div class="tip" id="fs22">Math.Atan(d: float) : float</div>
<div class="tip" id="fs23">val toCartesian : polar:Polar -&gt; Vector<br /><br />Full name: FsWPF.Core.toCartesian</div>
<div class="tip" id="fs24">val polar : Polar</div>
<div class="tip" id="fs25">Math.Cos(d: float) : float</div>
<div class="tip" id="fs26">Math.Sin(a: float) : float</div>
<div class="tip" id="fs27">val toDegrees : rads:float -&gt; float<br /><br />Full name: FsWPF.Core.toDegrees</div>
<div class="tip" id="fs28">val rads : float</div>
<div class="tip" id="fs29">field Math.PI = 3.14159265359</div>
<div class="tip" id="fs30">type Particle =<br />&#160;&#160;{Coords: Vector;<br />&#160;&#160;&#160;Mass: float;<br />&#160;&#160;&#160;Img: string;<br />&#160;&#160;&#160;Alpha: float;<br />&#160;&#160;&#160;AlphaTarget: float;<br />&#160;&#160;&#160;Velocity: Vector;<br />&#160;&#160;&#160;AngularVelocity: float;<br />&#160;&#160;&#160;Acceleration: Vector;<br />&#160;&#160;&#160;TimeToLive: float;<br />&#160;&#160;&#160;Life: float;<br />&#160;&#160;&#160;...}<br /><br />Full name: FsWPF.Particle.Particle</div>
<div class="tip" id="fs31">Particle.Coords: Vector</div>
<div class="tip" id="fs32">Particle.Mass: float</div>
<div class="tip" id="fs33">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = System.Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs34">Particle.Img: string</div>
<div class="tip" id="fs35">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs36">Particle.Alpha: float</div>
<div class="tip" id="fs37">Particle.AlphaTarget: float</div>
<div class="tip" id="fs38">Particle.Velocity: Vector</div>
<div class="tip" id="fs39">Particle.AngularVelocity: float</div>
<div class="tip" id="fs40">Particle.Acceleration: Vector</div>
<div class="tip" id="fs41">Particle.TimeToLive: float</div>
<div class="tip" id="fs42">Particle.Life: float</div>
<div class="tip" id="fs43">Particle.Rotation: float</div>
<div class="tip" id="fs44">Particle.Scale: float</div>
<div class="tip" id="fs45">Particle.Locked: bool</div>
<div class="tip" id="fs46">type bool = System.Boolean<br /><br />Full name: Microsoft.FSharp.Core.bool</div>
<div class="tip" id="fs47">val exertForce : epicentre:Vector -&gt; strength:float -&gt; decayF:(float -&gt; float) -&gt; vec:Vector -&gt; Vector<br /><br />Full name: FsWPF.Particle.exertForce</div>
<div class="tip" id="fs48">val epicentre : Vector</div>
<div class="tip" id="fs49">val strength : float</div>
<div class="tip" id="fs50">val decayF : (float -&gt; float)</div>
<div class="tip" id="fs51">val diff : Vector</div>
<div class="tip" id="fs52">val distance : float</div>
<div class="tip" id="fs53">val decay : float</div>
<div class="tip" id="fs54">module Particle<br /><br />from FsWPF</div>
<div class="tip" id="fs55">type MouseButtonStatus =<br />&#160;&#160;| LeftDown<br />&#160;&#160;| RightDown<br />&#160;&#160;| Released<br /><br />Full name: FsWPF.Engine.MouseButtonStatus</div>
<div class="tip" id="fs56">union case MouseButtonStatus.LeftDown: MouseButtonStatus</div>
<div class="tip" id="fs57">union case MouseButtonStatus.RightDown: MouseButtonStatus</div>
<div class="tip" id="fs58">union case MouseButtonStatus.Released: MouseButtonStatus</div>
<div class="tip" id="fs59">type EngineEvent = | MouseEvent of MouseButtonStatus * position: Vector<br /><br />Full name: FsWPF.Engine.EngineEvent</div>
<div class="tip" id="fs60">union case EngineEvent.MouseEvent: MouseButtonStatus * position: Vector -&gt; EngineEvent</div>
<div class="tip" id="fs61">type State =<br />&#160;&#160;{Particles: Particle list;<br />&#160;&#160;&#160;Forces: (Vector -&gt; Vector) list;<br />&#160;&#160;&#160;Colliders: (Particle -&gt; Particle) list;<br />&#160;&#160;&#160;Elapsed: float;}<br /><br />Full name: FsWPF.Engine.State</div>
<div class="tip" id="fs62">State.Particles: Particle list</div>
<div class="tip" id="fs63">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs64">Multiple items<br />module Particle<br /><br />from FsWPF<br /><br />--------------------<br />type Particle =<br />&#160;&#160;{Coords: Vector;<br />&#160;&#160;&#160;Mass: float;<br />&#160;&#160;&#160;Img: string;<br />&#160;&#160;&#160;Alpha: float;<br />&#160;&#160;&#160;AlphaTarget: float;<br />&#160;&#160;&#160;Velocity: Vector;<br />&#160;&#160;&#160;AngularVelocity: float;<br />&#160;&#160;&#160;Acceleration: Vector;<br />&#160;&#160;&#160;TimeToLive: float;<br />&#160;&#160;&#160;Life: float;<br />&#160;&#160;&#160;...}<br /><br />Full name: FsWPF.Particle.Particle</div>
<div class="tip" id="fs65">State.Forces: (Vector -&gt; Vector) list</div>
<div class="tip" id="fs66">State.Colliders: (Particle -&gt; Particle) list</div>
<div class="tip" id="fs67">State.Elapsed: float</div>
<div class="tip" id="fs68">Multiple items<br />type Animation =<br />&#160;&#160;new : spawnRate:float * maxParticles:int * particleEmitter:(unit -&gt; Particle) * tick:(float -&gt; State -&gt; State) * forces:(Vector -&gt; Vector) list * colliders:(Particle -&gt; Particle) list -&gt; Animation<br />&#160;&#160;member RaiseMouseEvent : status:EngineEvent -&gt; unit<br />&#160;&#160;member Update : delta:float -&gt; State<br />&#160;&#160;member MouseEvent : IObservable&lt;EngineEvent&gt;<br /><br />Full name: FsWPF.Engine.Animation<br /><br />--------------------<br />new : spawnRate:float * maxParticles:int * particleEmitter:(unit -&gt; Particle) * tick:(float -&gt; State -&gt; State) * forces:(Vector -&gt; Vector) list * colliders:(Particle -&gt; Particle) list -&gt; Animation</div>
<div class="tip" id="fs69">val spawnRate : float</div>
<div class="tip" id="fs70">val maxParticles : int</div>
<div class="tip" id="fs71">val particleEmitter : (unit -&gt; Particle)</div>
<div class="tip" id="fs72">val tick : (float -&gt; State -&gt; State)</div>
<div class="tip" id="fs73">val forces : (Vector -&gt; Vector) list</div>
<div class="tip" id="fs74">val colliders : (Particle -&gt; Particle) list</div>
<div class="tip" id="fs75">val x : Animation</div>
<div class="tip" id="fs76">val mouseEvent : Event&lt;EngineEvent&gt;</div>
<div class="tip" id="fs77">Multiple items<br />module Event<br /><br />from Microsoft.FSharp.Control<br /><br />--------------------<br />type Event&lt;&#39;T&gt; =<br />&#160;&#160;new : unit -&gt; Event&lt;&#39;T&gt;<br />&#160;&#160;member Trigger : arg:&#39;T -&gt; unit<br />&#160;&#160;member Publish : IEvent&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Control.Event&lt;_&gt;<br /><br />--------------------<br />type Event&lt;&#39;Delegate,&#39;Args (requires delegate and &#39;Delegate :&gt; Delegate)&gt; =<br />&#160;&#160;new : unit -&gt; Event&lt;&#39;Delegate,&#39;Args&gt;<br />&#160;&#160;member Trigger : sender:obj * args:&#39;Args -&gt; unit<br />&#160;&#160;member Publish : IEvent&lt;&#39;Delegate,&#39;Args&gt;<br /><br />Full name: Microsoft.FSharp.Control.Event&lt;_,_&gt;<br /><br />--------------------<br />new : unit -&gt; Event&lt;&#39;T&gt;<br /><br />--------------------<br />new : unit -&gt; Event&lt;&#39;Delegate,&#39;Args&gt;</div>
<div class="tip" id="fs78">val mutable state : State</div>
<div class="tip" id="fs79">val replace : ((&#39;a -&gt; bool) -&gt; &#39;a -&gt; &#39;a list -&gt; &#39;a list option)</div>
<div class="tip" id="fs80">val test : (&#39;a -&gt; bool)</div>
<div class="tip" id="fs81">val replacement : &#39;a</div>
<div class="tip" id="fs82">Multiple items<br />val list : &#39;a list<br /><br />--------------------<br />type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs83">val search : (&#39;a list -&gt; &#39;a list -&gt; &#39;a list option)</div>
<div class="tip" id="fs84">val acc : &#39;a list</div>
<div class="tip" id="fs85">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs86">val h : &#39;a</div>
<div class="tip" id="fs87">val t : &#39;a list</div>
<div class="tip" id="fs88">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs89">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs90">val rev : list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.rev</div>
<div class="tip" id="fs91">val spawnParticles : (float -&gt; Particle list -&gt; Particle list)</div>
<div class="tip" id="fs92">val toSpawn : float</div>
<div class="tip" id="fs93">val accu : Particle list</div>
<div class="tip" id="fs94">val a : float</div>
<div class="tip" id="fs95">property List.Length: int</div>
<div class="tip" id="fs96">val replaced : Particle list option</div>
<div class="tip" id="fs97">val p : Particle</div>
<div class="tip" id="fs98">val replaced : Particle list</div>
<div class="tip" id="fs99">val b : float</div>
<div class="tip" id="fs100">val applyForce : (Particle -&gt; Vector -&gt; (Vector -&gt; Vector) -&gt; Vector)</div>
<div class="tip" id="fs101">val particle : Particle</div>
<div class="tip" id="fs102">val accel : Vector</div>
<div class="tip" id="fs103">val force : (Vector -&gt; Vector)</div>
<div class="tip" id="fs104">val calcAcceleration : (Particle -&gt; Particle)</div>
<div class="tip" id="fs105">val fold : folder:(&#39;State -&gt; &#39;T -&gt; &#39;State) -&gt; state:&#39;State -&gt; list:&#39;T list -&gt; &#39;State<br /><br />Full name: Microsoft.FSharp.Collections.List.fold</div>
<div class="tip" id="fs106">val f : Vector</div>
<div class="tip" id="fs107">val pointInBounds : (Vector * Vector -&gt; Vector -&gt; bool)</div>
<div class="tip" id="fs108">val min : Vector</div>
<div class="tip" id="fs109">val max : Vector</div>
<div class="tip" id="fs110">val point : Vector</div>
<div class="tip" id="fs111">val boxCollider : (Vector -&gt; Vector -&gt; Particle -&gt; bool)</div>
<div class="tip" id="fs112">val floorCollider : (Particle -&gt; Particle)</div>
<div class="tip" id="fs113">val applyColliders : (Particle -&gt; Particle)</div>
<div class="tip" id="fs114">val id : x:&#39;T -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.id</div>
<div class="tip" id="fs115">Multiple items<br />val list : (Particle -&gt; Particle) list<br /><br />--------------------<br />type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs116">val updateAlpha : (Particle -&gt; Particle)</div>
<div class="tip" id="fs117">val lifeRatio : float</div>
<div class="tip" id="fs118">val updatePosition : (float -&gt; Particle -&gt; Particle)</div>
<div class="tip" id="fs119">val delta : float</div>
<div class="tip" id="fs120">val state : State</div>
<div class="tip" id="fs121">val updatedState : State</div>
<div class="tip" id="fs122">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs123">val this : Animation</div>
<div class="tip" id="fs124">member Animation.Update : delta:float -&gt; State<br /><br />Full name: FsWPF.Engine.Animation.Update</div>
<div class="tip" id="fs125">member Animation.RaiseMouseEvent : status:EngineEvent -&gt; unit<br /><br />Full name: FsWPF.Engine.Animation.RaiseMouseEvent</div>
<div class="tip" id="fs126">val status : EngineEvent</div>
<div class="tip" id="fs127">member Event.Trigger : arg:&#39;T -&gt; unit</div>
<div class="tip" id="fs128">member Animation.MouseEvent : IObservable&lt;EngineEvent&gt;<br /><br />Full name: FsWPF.Engine.Animation.MouseEvent</div>
<div class="tip" id="fs129">property Event.Publish: IEvent&lt;EngineEvent&gt;</div>
<div class="tip" id="fs130">type IObservable&lt;&#39;T&gt; =<br />&#160;&#160;member Subscribe : observer:IObserver&lt;&#39;T&gt; -&gt; IDisposable<br /><br />Full name: System.IObservable&lt;_&gt;</div>
<div class="tip" id="fs131">module Engine<br /><br />from FsWPF</div>
<div class="tip" id="fs132">Multiple items<br />module Core<br /><br />from FsWPF<br /><br />--------------------<br />namespace Microsoft.FSharp.Core</div>
<div class="tip" id="fs133">val private rand : Random<br /><br />Full name: FsWPF.Mist.rand</div>
<div class="tip" id="fs134">Multiple items<br />type Random =<br />&#160;&#160;new : unit -&gt; Random + 1 overload<br />&#160;&#160;member Next : unit -&gt; int + 2 overloads<br />&#160;&#160;member NextBytes : buffer:byte[] -&gt; unit<br />&#160;&#160;member NextDouble : unit -&gt; float<br /><br />Full name: System.Random<br /><br />--------------------<br />Random() : unit<br />Random(Seed: int) : unit</div>
<div class="tip" id="fs135">val BoxEmitter : min:Vector -&gt; max:Vector -&gt; unit -&gt; Vector<br /><br />Full name: FsWPF.Mist.BoxEmitter</div>
<div class="tip" id="fs136">Random.Next() : int<br />Random.Next(maxValue: int) : int<br />Random.Next(minValue: int, maxValue: int) : int</div>
<div class="tip" id="fs137">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs138">val emitter : (unit -&gt; Vector)<br /><br />Full name: FsWPF.Mist.emitter</div>
<div class="tip" id="fs139">val rand : Random<br /><br />Full name: FsWPF.Mist.rand</div>
<div class="tip" id="fs140">val CreateMistPatch : unit -&gt; Particle<br /><br />Full name: FsWPF.Mist.CreateMistPatch</div>
<div class="tip" id="fs141">val life : float</div>
<div class="tip" id="fs142">Random.NextDouble() : float</div>
<div class="tip" id="fs143">val private tick : delta:&#39;a -&gt; state:&#39;b -&gt; &#39;b<br /><br />Full name: FsWPF.Mist.tick</div>
<div class="tip" id="fs144">val delta : &#39;a</div>
<div class="tip" id="fs145">val state : &#39;b</div>
<div class="tip" id="fs146">Multiple items<br />val Animation : Animation<br /><br />Full name: FsWPF.Mist.Animation<br /><br />--------------------<br />type Animation =<br />&#160;&#160;new : spawnRate:float * maxParticles:int * particleEmitter:(unit -&gt; Particle) * tick:(float -&gt; State -&gt; State) * forces:(Vector -&gt; Vector) list * colliders:(Particle -&gt; Particle) list -&gt; Animation<br />&#160;&#160;member RaiseMouseEvent : status:EngineEvent -&gt; unit<br />&#160;&#160;member Update : delta:float -&gt; State<br />&#160;&#160;member MouseEvent : IObservable&lt;EngineEvent&gt;<br /><br />Full name: FsWPF.Engine.Animation<br /><br />--------------------<br />new : spawnRate:float * maxParticles:int * particleEmitter:(unit -&gt; Particle) * tick:(float -&gt; State -&gt; State) * forces:(Vector -&gt; Vector) list * colliders:(Particle -&gt; Particle) list -&gt; Animation</div>
<div class="tip" id="fs147">val pointInBounds : min:Vector * max:Vector -&gt; point:Vector -&gt; bool<br /><br />Full name: FsWPF.Snow.pointInBounds</div>
<div class="tip" id="fs148">val boxCollider : min:Vector -&gt; max:Vector -&gt; particle:Particle -&gt; bool<br /><br />Full name: FsWPF.Snow.boxCollider</div>
<div class="tip" id="fs149">val floorCollider : particle:Particle -&gt; Particle<br /><br />Full name: FsWPF.Snow.floorCollider</div>
<div class="tip" id="fs150">val private rand : Random<br /><br />Full name: FsWPF.Snow.rand</div>
<div class="tip" id="fs151">val BoxEmitter : min:Vector -&gt; max:Vector -&gt; unit -&gt; Vector<br /><br />Full name: FsWPF.Snow.BoxEmitter</div>
<div class="tip" id="fs152">val emitter : (unit -&gt; Vector)<br /><br />Full name: FsWPF.Snow.emitter</div>
<div class="tip" id="fs153">val CreateSnowFlake : unit -&gt; Particle<br /><br />Full name: FsWPF.Snow.CreateSnowFlake</div>
<div class="tip" id="fs154">val gravity : p:&#39;a -&gt; Vector<br /><br />Full name: FsWPF.Snow.gravity</div>
<div class="tip" id="fs155">val p : &#39;a</div>
<div class="tip" id="fs156">val wind : p:&#39;a -&gt; Vector<br /><br />Full name: FsWPF.Snow.wind</div>
<div class="tip" id="fs157">val private tick : delta:&#39;a -&gt; state:State -&gt; State<br /><br />Full name: FsWPF.Snow.tick</div>
<div class="tip" id="fs158">val wind : (&#39;b -&gt; Vector)</div>
<div class="tip" id="fs159">val mutable private mouseForce : (Vector -&gt; Vector)<br /><br />Full name: FsWPF.Snow.mouseForce</div>
<div class="tip" id="fs160">Multiple items<br />val Animation : Animation<br /><br />Full name: FsWPF.Snow.Animation<br /><br />--------------------<br />type Animation =<br />&#160;&#160;new : spawnRate:float * maxParticles:int * particleEmitter:(unit -&gt; Particle) * tick:(float -&gt; State -&gt; State) * forces:(Vector -&gt; Vector) list * colliders:(Particle -&gt; Particle) list -&gt; Animation<br />&#160;&#160;member RaiseMouseEvent : status:EngineEvent -&gt; unit<br />&#160;&#160;member Update : delta:float -&gt; State<br />&#160;&#160;member MouseEvent : IObservable&lt;EngineEvent&gt;<br /><br />Full name: FsWPF.Engine.Animation<br /><br />--------------------<br />new : spawnRate:float * maxParticles:int * particleEmitter:(unit -&gt; Particle) * tick:(float -&gt; State -&gt; State) * forces:(Vector -&gt; Vector) list * colliders:(Particle -&gt; Particle) list -&gt; Animation</div>
<div class="tip" id="fs161">val private applyMouseForce : _arg1:EngineEvent -&gt; unit<br /><br />Full name: FsWPF.Snow.applyMouseForce</div>
<div class="tip" id="fs162">val currentPos : Vector</div>
<div class="tip" id="fs163">val d : float</div>
<div class="tip" id="fs164">property Animation.MouseEvent: IObservable&lt;EngineEvent&gt;</div>
<div class="tip" id="fs165">module Observable<br /><br />from Microsoft.FSharp.Control</div>
<div class="tip" id="fs166">val subscribe : callback:(&#39;T -&gt; unit) -&gt; source:IObservable&lt;&#39;T&gt; -&gt; IDisposable<br /><br />Full name: Microsoft.FSharp.Control.Observable.subscribe</div>
<div class="tip" id="fs167">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs168">namespace FSharp</div>
<div class="tip" id="fs169">namespace FSharp.ViewModule</div>
<div class="tip" id="fs170">namespace System.Windows</div>
<div class="tip" id="fs171">namespace System.Windows.Input</div>
<div class="tip" id="fs172">namespace System.Windows.Controls</div>
<div class="tip" id="fs173">namespace FsXaml</div>
<div class="tip" id="fs174">module Snow<br /><br />from FsWPF</div>
<div class="tip" id="fs175">namespace System.Collections</div>
<div class="tip" id="fs176">namespace System.Collections.ObjectModel</div>
<div class="tip" id="fs177">namespace System.Windows.Threading</div>
<div class="tip" id="fs178">module View<br /><br />from FsWPF</div>
<div class="tip" id="fs179"></div>
<div class="tip" id="fs180">val x : float</div>
<div class="tip" id="fs181">val y : float</div>
<div class="tip" id="fs182">val x : obj</div>
<div class="tip" id="fs183">val y : obj</div>
<div class="tip" id="fs184">val v : obj</div>
<div class="tip" id="fs185">member ParticleViewModel.X : obj<br /><br />Full name: FsWPF.View.ParticleViewModel.X</div>
<div class="tip" id="fs186">member ParticleViewModel.Y : obj<br /><br />Full name: FsWPF.View.ParticleViewModel.Y</div>
<div class="tip" id="fs187">val Animation : Animation<br /><br />Full name: FsWPF.Snow.Animation</div>
<div class="tip" id="fs188">val particles : Particle list</div>
<div class="tip" id="fs189">val iteri : action:(int -&gt; &#39;T -&gt; unit) -&gt; list:&#39;T list -&gt; unit<br /><br />Full name: Microsoft.FSharp.Collections.List.iteri</div>
<div class="tip" id="fs190">val i : int</div>
<div class="tip" id="fs191">val x : int</div>
<div class="tip" id="fs192">val collection : ObservableCollection&lt;ParticleViewModel&gt;</div>
<div class="tip" id="fs193">property Collection.Count: int</div>
<div class="tip" id="fs194">Collection.Add(item: ParticleViewModel) : unit</div>
<div class="tip" id="fs195">Multiple items<br />type ParticleViewModel =<br />&#160;&#160;inherit ViewModelBase<br />&#160;&#160;new : x:float * y:float * scale:float * rotation:float * alpha:float -&gt; ParticleViewModel<br />&#160;&#160;member Alpha : obj<br />&#160;&#160;member Rotation : obj<br />&#160;&#160;member Scale : obj<br />&#160;&#160;member X : obj<br />&#160;&#160;member Y : obj<br />&#160;&#160;member Alpha : obj with set<br />&#160;&#160;member Rotation : obj with set<br />&#160;&#160;member Scale : obj with set<br />&#160;&#160;...<br /><br />Full name: FsWPF.View.ParticleViewModel<br /><br />--------------------<br />new : x:float * y:float * scale:float * rotation:float * alpha:float -&gt; ParticleViewModel</div>
<div class="tip" id="fs196">val snowState : State</div>
<div class="tip" id="fs197">val elapsed : float</div>
<div class="tip" id="fs198">val updateParticleUI : (ObservableCollection&lt;ParticleViewModel&gt; -&gt; Particle list -&gt; unit)</div>
<div class="tip" id="fs199">val particles : ObservableCollection&lt;ParticleViewModel&gt;</div>
<div class="tip" id="fs200">val frameTimer : DispatcherTimer</div>
<div class="tip" id="fs201">event DispatcherTimer.Tick: IEvent&lt;EventHandler,EventArgs&gt;</div>
<div class="tip" id="fs202">val scan : collector:(&#39;U -&gt; &#39;T -&gt; &#39;U) -&gt; state:&#39;U -&gt; source:IObservable&lt;&#39;T&gt; -&gt; IObservable&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Control.Observable.scan</div>
<div class="tip" id="fs203">type Environment =<br />&#160;&#160;static member CommandLine : string<br />&#160;&#160;static member CurrentDirectory : string with get, set<br />&#160;&#160;static member Exit : exitCode:int -&gt; unit<br />&#160;&#160;static member ExitCode : int with get, set<br />&#160;&#160;static member ExpandEnvironmentVariables : name:string -&gt; string<br />&#160;&#160;static member FailFast : message:string -&gt; unit + 1 overload<br />&#160;&#160;static member GetCommandLineArgs : unit -&gt; string[]<br />&#160;&#160;static member GetEnvironmentVariable : variable:string -&gt; string + 1 overload<br />&#160;&#160;static member GetEnvironmentVariables : unit -&gt; IDictionary + 1 overload<br />&#160;&#160;static member GetFolderPath : folder:SpecialFolder -&gt; string + 1 overload<br />&#160;&#160;...<br />&#160;&#160;nested type SpecialFolder<br />&#160;&#160;nested type SpecialFolderOption<br /><br />Full name: System.Environment</div>
<div class="tip" id="fs204">property Environment.TickCount: int</div>
<div class="tip" id="fs205">val previous : float</div>
<div class="tip" id="fs206">val x : MainViewModel</div>
<div class="tip" id="fs207">val updateParticleUI : collection:ObservableCollection&lt;ParticleViewModel&gt; -&gt; particles:Particle list -&gt; unit<br /><br />Full name: FsWPF.View.updateParticleUI</div>
<div class="tip" id="fs208">Multiple items<br />type ObservableCollection&lt;&#39;T&gt; =<br />&#160;&#160;inherit Collection&lt;&#39;T&gt;<br />&#160;&#160;new : unit -&gt; ObservableCollection&lt;&#39;T&gt; + 2 overloads<br />&#160;&#160;member Move : oldIndex:int * newIndex:int -&gt; unit<br />&#160;&#160;event CollectionChanged : NotifyCollectionChangedEventHandler<br /><br />Full name: System.Collections.ObjectModel.ObservableCollection&lt;_&gt;<br /><br />--------------------<br />ObservableCollection() : unit<br />ObservableCollection(list: Collections.Generic.List&lt;&#39;T&gt;) : unit<br />ObservableCollection(collection: Collections.Generic.IEnumerable&lt;&#39;T&gt;) : unit</div>
<div class="tip" id="fs209">val particles : ObservableCollection&lt;ParticleViewModel&gt;<br /><br />Full name: FsWPF.View.particles</div>
<div class="tip" id="fs210">val mistParticles : ObservableCollection&lt;ParticleViewModel&gt;<br /><br />Full name: FsWPF.View.mistParticles</div>
<div class="tip" id="fs211">val onTick : &#39;a * elapsed:float -&gt; unit<br /><br />Full name: FsWPF.View.onTick</div>
<div class="tip" id="fs212">val mistState : State</div>
<div class="tip" id="fs213">module Mist<br /><br />from FsWPF</div>
<div class="tip" id="fs214">val Animation : Animation<br /><br />Full name: FsWPF.Mist.Animation</div>
<div class="tip" id="fs215">val mouseConverter : args:MouseEventArgs -&gt; EngineEvent<br /><br />Full name: FsWPF.View.EventConverters.mouseConverter</div>
<div class="tip" id="fs216">val args : MouseEventArgs</div>
<div class="tip" id="fs217">Multiple items<br />type MouseEventArgs =<br />&#160;&#160;inherit InputEventArgs<br />&#160;&#160;new : mouse:MouseDevice * timestamp:int -&gt; MouseEventArgs + 1 overload<br />&#160;&#160;member GetPosition : relativeTo:IInputElement -&gt; Point<br />&#160;&#160;member LeftButton : MouseButtonState<br />&#160;&#160;member MiddleButton : MouseButtonState<br />&#160;&#160;member MouseDevice : MouseDevice<br />&#160;&#160;member RightButton : MouseButtonState<br />&#160;&#160;member StylusDevice : StylusDevice<br />&#160;&#160;member XButton1 : MouseButtonState<br />&#160;&#160;member XButton2 : MouseButtonState<br /><br />Full name: System.Windows.Input.MouseEventArgs<br /><br />--------------------<br />MouseEventArgs(mouse: MouseDevice, timestamp: int) : unit<br />MouseEventArgs(mouse: MouseDevice, timestamp: int, stylusDevice: StylusDevice) : unit</div>
<div class="tip" id="fs218">val status : MouseButtonStatus</div>
<div class="tip" id="fs219">property MouseEventArgs.LeftButton: MouseButtonState</div>
<div class="tip" id="fs220">type MouseButtonState =<br />&#160;&#160;| Released = 0<br />&#160;&#160;| Pressed = 1<br /><br />Full name: System.Windows.Input.MouseButtonState</div>
<div class="tip" id="fs221">field MouseButtonState.Pressed = 1</div>
<div class="tip" id="fs222">property MouseEventArgs.RightButton: MouseButtonState</div>
<div class="tip" id="fs223">val pt : Point</div>
<div class="tip" id="fs224">MouseEventArgs.GetPosition(relativeTo: IInputElement) : Point</div>
<div class="tip" id="fs225">property RoutedEventArgs.OriginalSource: obj</div>
<div class="tip" id="fs226">type IInputElement =<br />&#160;&#160;member AddHandler : routedEvent:RoutedEvent * handler:Delegate -&gt; unit<br />&#160;&#160;member CaptureMouse : unit -&gt; bool<br />&#160;&#160;member CaptureStylus : unit -&gt; bool<br />&#160;&#160;member Focus : unit -&gt; bool<br />&#160;&#160;member Focusable : bool with get, set<br />&#160;&#160;member IsEnabled : bool<br />&#160;&#160;member IsKeyboardFocusWithin : bool<br />&#160;&#160;member IsKeyboardFocused : bool<br />&#160;&#160;member IsMouseCaptured : bool<br />&#160;&#160;member IsMouseDirectlyOver : bool<br />&#160;&#160;...<br /><br />Full name: System.Windows.IInputElement</div>
<div class="tip" id="fs227">property Point.X: float</div>
<div class="tip" id="fs228">property Point.Y: float</div>
<div class="tip" id="fs229">Multiple items<br />type MouseConverter =<br />&#160;&#160;inherit EventArgsConverter&lt;MouseEventArgs,EngineEvent&gt;<br />&#160;&#160;new : unit -&gt; MouseConverter<br /><br />Full name: FsWPF.View.MouseConverter<br /><br />--------------------<br />new : unit -&gt; MouseConverter</div>
<div class="tip" id="fs230">Multiple items<br />type EventArgsConverter&lt;&#39;a,&#39;b (requires &#39;a :&gt; EventArgs)&gt; =<br />&#160;&#160;inherit EventArgsConverterBase<br />&#160;&#160;new : convertFun:(&#39;a -&gt; &#39;b) * defaultOnFailure:&#39;b -&gt; EventArgsConverter&lt;&#39;a,&#39;b&gt;<br /><br />Full name: FsXaml.EventArgsConverter&lt;_,_&gt;<br /><br />--------------------<br />new : convertFun:(&#39;a -&gt; &#39;b) * defaultOnFailure:&#39;b -&gt; EventArgsConverter&lt;&#39;a,&#39;b&gt;</div>
<div class="tip" id="fs231">module EventConverters<br /><br />from FsWPF.View</div>

